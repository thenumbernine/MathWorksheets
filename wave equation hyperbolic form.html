<!doctype html>
<html>
	<head>
        <meta charset='utf-8'>
		<title>wave equation in hyperbolic form</title>
		<script type='text/javascript' src='tryToFindMathJax.js'></script>
	</head>
    <body>

wave equation:<br>
$\square \phi = 0$<br>
where $\square$ is the <a href='https://en.wikipedia.org/wiki/D%27Alembert_operator'>d'Alembert operator</a><br>
$\phi_{,tt} - c^2 {\phi_{;i}}^i = 0$<br>
$c^{-2} \phi_{,tt} - g^{ij} \phi_{;ij} = 0$<br>
$c^{-2} \phi_{,tt} - g^{ij} (\phi_{,i})_{;j} = 0$<br>
$c^{-2} \phi_{,tt} - g^{ij} (\phi_{,ij} - {\Gamma^k}_{ij} \phi_{,k}) = 0$<br>
$c^{-2} \phi_{,tt} - g^{ij} \phi_{,ij} + {\Gamma^{ij}}_j \phi_{,i} = 0$<br>
<br>

Let $\Pi = c^{-1} \phi_{,t}$<br>
Let $\Psi_i = \phi_{,i}$<br>
<br>

$c^{-1} \phi_{,t} = \Pi$<br>
$c^{-1} \Pi_{,t} - g^{jk} \Psi_{j,k} = -{\Gamma^{jk}}_k \Psi_j$<br>
$c^{-1} \Psi_{i,t} - \Pi_{,i} = 0$<br>
<br>

Produces:<br>
$\left[\begin{matrix}
	\Pi \\ \Psi_i
\end{matrix}\right]_{,t} + \left[\begin{matrix}
	0 & -c g^{jk} \\
	-c \delta^k_i & 0
\end{matrix}\right] \left[\begin{matrix}
	\Pi \\ \Psi_j
\end{matrix}\right]_{,k} = \left[\begin{matrix}
	-c {\Gamma^{jk}}_k \Psi_j \\ 0
\end{matrix}\right]$<br>
<br>

Flux Jacobian in x dir:<br>
$\left[\begin{matrix}
	 0 & -c g^{xx} & -c g^{xy} & -c g^{xz} \\
	-c &     0     &     0     &     0     \\
	 0 &     0     &     0     &     0     \\
	 0 &     0     &     0     &     0     \\
\end{matrix}\right]$<br>
<br>

Flux Jacobian in y dir:<br>
$\left[\begin{matrix}
	  0 & -c g^{xy} & -c g^{yy} & -c g^{yz} \\
	  0 &     0     &     0     &     0     \\
	 -c &     0     &     0     &     0     \\
	  0 &     0     &     0     &     0     \\
\end{matrix}\right]$<br>
<br>

Flux Jacobian in z dir:<br>
$\left[\begin{matrix}
	  0 & -c g^{xz} & -c g^{yz} & -c g^{zz} \\
	  0 &     0     &     0     &     0     \\
	  0 &     0     &     0     &     0     \\
	 -c &     0     &     0     &     0     \\
\end{matrix}\right]$<br>
<br>

TODO redo eigendecomposition<br>
<br>

x dir has eigensystem:<br>
$\lambda_x = \{-c \sqrt{g^{xx}}, 0, 0, c \sqrt{g^{xx}} \}$<br>
$R_x = \left[\begin{matrix}
	\sqrt{g^{xx}} & 0 & 0 & -\sqrt{g^{xx}} \\
	1 & -g^{xy} & -g^{xz} & 1 \\
	0 & g^{xx} & 0 & 0 \\
	0 & 0 & g^{xx} & 0
\end{matrix}\right]$<br>
$L_x = (R_x)^{-1} = \left[\begin{matrix}
	\frac{1}{2 \sqrt{g^{xx}}} & \frac{1}{2} & \frac{g^{xy}}{2 g^{xx}} & \frac{g^{xz}}{2 g^{xx}} \\
	0 & 0 & \frac{1}{g^{xx}} & 0 \\
	0 & 0 & 0 & \frac{1}{g^{xx}} \\
	-\frac{1}{2 \sqrt{g^{xx}}} & \frac{1}{2} & \frac{g^{xy}}{2 g^{xx}} & \frac{g^{xz}}{2 g^{xx}}
\end{matrix}\right]$<br>
<br>

y dir has eigensystem:<br>
$\lambda_y = \{-c \sqrt{g^{yy}}, 0, 0, c \sqrt{g^{yy}} \}$<br>
$R_y = \left[\begin{matrix}
	\sqrt{g^{yy}} & 0 & 0 & -\sqrt{g^{yy}} \\
	0 & 0 & g^{yy} & 0 \\
	1 & -g^{yz} & -g^{xy} & 1 \\
	0 & g^{yy} & 0 & 0
\end{matrix}\right]$<br>
$L_y = (R_y)^{-1} = \left[\begin{matrix}
	\frac{1}{2 \sqrt{g^{yy}}} & \frac{g^{xy}}{2 g^{yy}} & \frac{1}{2} & \frac{g^{yz}}{2 g^{yy}} \\
	0 & 0 & 0 & \frac{1}{g^{yy}} \\
	0 & \frac{1}{g^{yy}} & 0 & 0 \\
	-\frac{1}{2 \sqrt{g^{yy}}} & \frac{g^{xy}}{2 g^{yy}} & \frac{1}{2} & \frac{g^{yz}}{2 g^{yy}}
\end{matrix}\right]$<br>
<br>

z dir has eigensystem:<br>
$\lambda = \{-c \sqrt{g^{zz}}, 0, 0, c \sqrt{g^{zz}} \}$<br>
$R_z = \left[\begin{matrix}
	\sqrt{g^{zz}} & 0 & 0 & -\sqrt{g^{zz}} \\
	0 & g^{zz} & 0 & 0 \\
	0 & 0 & g^{zz} & 0 \\
	1 & -g^{xz} & -g^{yz} & 1
\end{matrix}\right]$<br>
$L_z = (R_z)^{-1} = \left[\begin{matrix}
	\frac{1}{2 \sqrt{g^{zz}}} & \frac{g^{xz}}{2 g^{zz}} & \frac{g^{yz}}{2 g^{zz}} & \frac{1}{2} \\
	0 & \frac{1}{g^{zz}} & 0 & 0 \\
	0 & 0 & \frac{1}{g^{zz}} & 0 \\
	-\frac{1}{2 \sqrt{g^{zz}}} & \frac{g^{xz}}{2 g^{zz}} & \frac{g^{yz}}{2 g^{zz}} & \frac{1}{2}
\end{matrix}\right]$<br>
<br>

<hr>
<br>

Let's try that again but with volume element weighting:<br>
	
$\phi_{,tt} - c^2 {\phi_{;i}}^i = 0$<br>
Assuming $g_{ij}$ is not a function of $t$...<br>
$\phi_{,tt} - \frac{1}{\sqrt{|g|}} (\sqrt{|g|} c^2 g^{ij} \phi_{,i})_{,j} - \frac{1}{\sqrt{|g|}} {c^{ij}}_j \phi_{,i} = 0$<br>
<br>
$\Pi_{,t} - \frac{1}{\sqrt{|g|}} (\sqrt{|g|} c^2 g^{ij} \Psi_i)_{,j} = \frac{1}{\sqrt{|g|}} {c^{ij}}_j \phi_{,i}$<br>
$\Psi_{i,t} - \frac{1}{\sqrt{|g|}} (\sqrt{|g|} \Pi)_{,i} = -{\Gamma^j}_{ji} \Pi$<br>
<br>
$\left[\begin{matrix}
	\Pi \\ \Psi_i
\end{matrix}\right]_{,t}
+ \frac{1}{\sqrt{|g|}} \left(
	\sqrt{|g|} \cdot
	\left[\begin{matrix}
		0 & -c^2 g^{jk} \\
		-\delta^k_i & 0
	\end{matrix}\right] \left[\begin{matrix}
		\Pi \\ \Psi_j
	\end{matrix}\right]
\right)_{,k}
= \left[\begin{matrix}
	\frac{1}{\sqrt{|g|}} {c^{ij}}_j \phi_{,i} \\ 
	-{\Gamma^j}_{ij} \Pi
\end{matrix}\right]$<br>
<br>

or, if you want to model the $\phi_{,i}$ as a flux term,<br>
<br>

$\phi_{,t} = \Pi$<br>
$\Pi_{,t} 
	- \frac{1}{\sqrt{|g|}} {c^{ij}}_j \phi_{,i} 
	- \frac{1}{\sqrt{|g|}} (\sqrt{|g|} c^2 g^{ij} \Psi_i)_{,j} 
	= 0$<br>
$\Pi_{,t} 
	- \frac{1}{\sqrt{|g|}} (\sqrt{|g|} (c^2 g^{ij} \Psi_i + \frac{1}{\sqrt{|g|}} {c^{ji}}_i \phi))_{,j} 
	= 
	- \frac{1}{\sqrt{|g|}} {c^{ij}}_{j,i} \phi$<br>
$\Psi_{i,t} - \frac{1}{\sqrt{|g|}} (\sqrt{|g|} \Pi)_{,i} = -{\Gamma^j}_{ji} \Pi$<br>
<br>

$\left[\begin{matrix}
	\phi \\ \Pi \\ \Psi_i
\end{matrix}\right]_{,t}
+ \frac{1}{\sqrt{|g|}} \left(
	\sqrt{|g|} \cdot
	\left[\begin{matrix}
		0 & 0 & 0 \\
		\frac{1}{\sqrt{|g|}} {c^{kj}}_j & 0 & -c^2 g^{jk} \\
		0 & -\delta^k_i & 0
	\end{matrix}\right] \left[\begin{matrix}
		\phi \\ \Pi \\ \Psi_j
	\end{matrix}\right]
\right)_{,k}
= \left[\begin{matrix}
	\Pi \\ 
	\frac{1}{\sqrt{|g|}} {c^{kj}}_{j,k} \phi \\ 
	-{\Gamma^j}_{ji} \Pi
\end{matrix}\right]$<br>


<hr>
<br>

How about changing the first-order variables?<br>

$\Pi = \phi_{,t}$<br>
$\Psi_i = \sqrt{|g|} \phi_{,i}$<br>
assuming a steady grid, so $g_{ij,t} = 0$<br>
<br>
$\Pi_{,t} - \frac{1}{\sqrt{|g|}} (c^2 g^{ij} \Psi_i)_{,j} = 0$<br>
$\Psi_{i,t} - \sqrt{|g|} \Pi_{,i} = 0$<br>
<br>

<hr>
<br>

$\Pi = \sqrt{|g|} \phi_{,t}$<br>
$\Psi_i = \sqrt{|g|} \phi_{,i}$<br>
$\Psi_{i,t} = \sqrt{|g|} \phi_{,ti}$<br>
$\Psi_{i,t} = (\sqrt{|g|} \phi_{,t})_{,i} - (\sqrt{|g|})_{,i} \phi_{,t}$<br>
$\Psi_{i,t} - \Pi_{,i} = -\frac{1}{\sqrt{|g|}} (\sqrt{|g|})_{,i} \Pi$<br>
$\frac{1}{\sqrt{|g|}} \Pi_{,t} - \frac{1}{\sqrt{|g|}} (c^2 g^{ij} \Psi_i)_{,j} = 0$<br>
$\Pi_{,t} - (c^2 g^{ij} \Psi_i)_{,j} = 0$<br>
$\Psi_{i,t} - \Pi_{,i} = -{\Gamma^j}_{ji} \Pi$<br>
<br>

	</body>
</html>
