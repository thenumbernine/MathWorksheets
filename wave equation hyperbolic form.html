<!doctype html>
<html>
	<head>
        <meta charset='utf-8'>
		<title>wave equation in hyperbolic form</title>
		<script type='text/javascript' src='tryToFindMathJax.js'></script>
	</head>
    <body>

Start with my 'wave equation in spacetime' worksheet for an introduction to a scalar wave propagating in curved spacetime: <a href='https://thenumbernine.github.io/symmath/tests/output/wave%20equation%20in%20spacetime.html'>https://thenumbernine.github.io/symmath/tests/output/wave%20equation%20in%20spacetime.html</a><br>
<br>

unit conversion: $dx^0 = c dt, \partial_0 = \frac{1}{c} \partial_t$<br>
<br>

Written as a linear system:<br>
<br>

$\left[ \begin{matrix}
  \Pi \\
  \Psi_i
\end{matrix} \right]_{,0}
= \left[ \begin{matrix}  
	\Pi_{,i} \beta^i
	+ \Psi_i \alpha_{,j} \gamma^{ij} 
	+ K \Pi \alpha 
	+ \alpha \Psi_{i,j} \gamma^{ij} 
	- \alpha \Psi_i \Gamma^i 
	- f \alpha \\
	
	\Psi_j {\beta^j}_{,i}
	+ \beta^j \Psi_{i,j}
	+ \alpha_{,i} \Pi
	+ \alpha \Pi_{,i}
\end{matrix} \right]$<br>
<br>

$\left[ \begin{matrix}
  \Pi \\
  \Psi_i
\end{matrix} \right]_{,0}
+ \left[ \begin{matrix}  
	- \Pi_{,i} \beta^i
	- \alpha \Psi_{i,j} \gamma^{ij} \\	

	- \beta^j \Psi_{i,j}
	- \alpha \Pi_{,i}
\end{matrix} \right]
= \left[ \begin{matrix}
	\Psi_i \alpha_{,j} \gamma^{ij} 
	+ K \Pi \alpha 
	- \alpha \Psi_i \Gamma^i 
	- f \alpha \\
	
	\Psi_j {\beta^j}_{,i}
	+ \alpha_{,i} \Pi
\end{matrix} \right]$<br>
<br>

$\left[ \begin{matrix}
  \Pi \\
  \Psi_i
\end{matrix} \right]_{,t}
+ c \left[ \begin{matrix}  
	-\beta^k &
	-\alpha \gamma^{jk} \\	

	- \alpha \delta^k_i &
	- \beta^k \delta^j_i
\end{matrix} \right]
\left[ \begin{matrix}
  \Pi \\
  \Psi_j
\end{matrix} \right]_{,k}
= \left[ \begin{matrix}
	\Psi_i \alpha_{,j} \gamma^{ij} 
	+ K \Pi \alpha 
	- \alpha \Psi_i \Gamma^i 
	- f \alpha \\
	
	\Psi_j {\beta^j}_{,i}
	+ \alpha_{,i} \Pi
\end{matrix} \right]$<br>
<br>

(TODO explain this better)<br>
Let $n = n^i \partial_i$ be the vector normal to the flux surface.<br>
Contravariant normals would have values $n^i = g^{ij} n_j$<br>
Then normals along the cartesian $x,y,z$ would have values, i.e. in the k direction: $n_i = \delta_{ik}$ and $n^i = g^{ik}$<br>
The length of a normal $|n| = \sqrt{n^i n_i}$ along any cartesian basis in the k direction would be $|n| = \sqrt{\underset{i}{\Sigma} (g^{ik} \delta_{ik})} = \sqrt{g^{kk}}$<br>
Also let $n_2$ and $n_3$ be orthogonal to $n$ such that $n^i (n_2)_i = n^i (n_3)_i = 0$ and $|n_2| = |n_3| = |n|$<br>
<br>

Flux Jacobian:<br>
<br>

$F = \left[ \begin{matrix}  
	-c \beta^k &
	-c \alpha \gamma^{jk} \\	

	-c \alpha \delta^k_i &
	-c \beta^k \delta^j_i
\end{matrix} \right]$<br>
<br>

Flux Jacobian in terms of flux surface normal:<br>
<br>

$F = \left[ \begin{matrix}  
	-c \beta_n &
	-c \alpha n^j \\	

	-c \alpha n_i &
	-c \beta_n \delta^j_i
\end{matrix} \right]$<br>
<br>

...where $\beta^n = \beta^i n_i$<br>
<br>

Expand components into x,y,z:<br>
<br>

$F = \left[ \begin{matrix}
	-c \beta_n &
	-c \alpha n^x &
	-c \alpha n^y &
	-c \alpha n^z \\

	-c \alpha n_x & -c \beta_n & 0 & 0 \\
	-c \alpha n_y & 0 & -c \beta_n & 0 \\
	-c \alpha n_z & 0 & 0 & -c \beta_n
\end{matrix} \right]$<br>
<br>

Acoustic matrix:<br>
<br>

$A = F + c \beta_n I$<br>
<br>

$A = \left[ \begin{matrix}
	0 &
	-c \alpha n^x &
	-c \alpha n^y &
	-c \alpha n^z \\

	-c \alpha n_x & 0 & 0 & 0 \\
	-c \alpha n_y & 0 & 0 & 0 \\
	-c \alpha n_z & 0 & 0 & 0
\end{matrix} \right]$<br>
<br>

Eigenvalues of A:<br>
$A R_A = \lambda R_A$<br>
$(A - I \lambda) R_A = 0$<br>
$|A - I \lambda| = 0$<br>
<br>

$\left| \begin{matrix}
	-\lambda &
	- c \alpha n^x &
	- c \alpha n^y &
	- c \alpha n^z \\

	-c \alpha n_x & -\lambda & 0 & 0 \\
	-c \alpha n_y & 0 & -\lambda & 0 \\
	-c \alpha n_z & 0 & 0 & -\lambda
\end{matrix} \right| = 0$<br>
<br>

$c \alpha n_z
\left| \begin{matrix}
	- c \alpha n^x &
	- c \alpha n^y &
	- c \alpha n^z \\

	-\lambda & 0 & 0 \\
	0 & -\lambda & 0 \\
\end{matrix} \right|

- \lambda
\left| \begin{matrix}
	-\lambda &
	- c \alpha n^x &
	- c \alpha n^y \\

	-c \alpha n_x & -\lambda & 0 \\
	-c \alpha n_y & 0 & -\lambda 
\end{matrix} \right| = 0$<br>
<br>

$-c^2 \alpha^2 n_z n^z \lambda^2
- \lambda \left(
	-c \alpha n_y
	\left| \begin{matrix}
		- c \alpha n^x &
		- c \alpha n^y \\

		-\lambda & 0
	\end{matrix} \right|

	- \lambda
	\left| \begin{matrix}
		-\lambda &
		- c \alpha n^x \\

		-c \alpha n_x & -\lambda 
	\end{matrix} \right|
\right)
 = 0$<br>
<br>

$-c^2 \alpha^2 n_z n^z \lambda^2
- \lambda \left(
	c^2 \alpha^2 n_y n^y \lambda 

	- \lambda (
		\lambda^2
		- c^2 \alpha^2 n^x n_x 
	)
\right)
 = 0$<br>
<br>

$\lambda^2 (
	\lambda^2
	- c^2 \alpha^2 n_x n^x
	- c^2 \alpha^2 n_y n^y
	- c^2 \alpha^2 n_z n^z
) = 0$<br>
<br>

$\lambda^2 (\lambda^2 - c^2 \alpha^2 |n|^2) = 0$<br>
$\lambda^2 (\lambda + c \alpha |n|) (\lambda - c \alpha |n|) = 0$<br>
<br>

...has eigenvalues:<br>
$\lambda = \{-\alpha c |n|, 0, 0, \alpha c |n| \}$<br>
<br>

For $\lambda = 0$:<br>
<br>

$\left[ \begin{matrix}
	0 &
	-c \alpha n^x &
	-c \alpha n^y &
	-c \alpha n^z \\

	-c \alpha n_x & 0 & 0 & 0 \\
	-c \alpha n_y & 0 & 0 & 0 \\
	-c \alpha n_z & 0 & 0 & 0
\end{matrix} \right] 
\left[ \begin{matrix}
	X^\Pi \\
	X^{\Psi_x} \\
	X^{\Psi_y} \\
	X^{\Psi_z}
\end{matrix} \right]
= 0$<br>
<br>

$\left[ \begin{matrix}
	0 &
	n^x &
	n^y &
	n^z \\

	1 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0
\end{matrix} \right]
\left[ \begin{matrix}
	X^\Pi \\
	X^{\Psi_x} \\
	X^{\Psi_y} \\
	X^{\Psi_z}
\end{matrix} \right]
= 0$<br>
<br>

...we have the solution...<br>
<br>

$\left[ \begin{matrix}
	X^\Pi \\
	X^{\Psi_x} \\
	X^{\Psi_y} \\
	X^{\Psi_z}
\end{matrix} \right]
= \left[ \begin{matrix}
	0 & 0 \\
	(n_2)_x & (n_3)_x \\
	(n_2)_y & (n_3)_y \\
	(n_2)_z & (n_3)_z
\end{matrix} \right]$<br>
<br>

For $\lambda = \pm \alpha c |n|$:<br>
<br>

$\left[ \begin{matrix}
	\mp c \alpha |n| &
	-c \alpha n^x &
	-c \alpha n^y &
	-c \alpha n^z \\

	-c \alpha n_x & \mp c \alpha |n| & 0 & 0 \\
	-c \alpha n_y & 0 & \mp c \alpha |n| & 0 \\
	-c \alpha n_z & 0 & 0 & \mp c \alpha |n|
\end{matrix} \right] 
\left[ \begin{matrix}
	X^\Pi \\
	X^{\Psi_x} \\
	X^{\Psi_y} \\
	X^{\Psi_z}
\end{matrix} \right]
= 0$<br>
<br>

...we have the solution...<br>
<br>

$\left[ \begin{matrix}
	X^\Pi \\
	X^{\Psi_x} \\
	X^{\Psi_y} \\
	X^{\Psi_z}
\end{matrix} \right]
= \left[ \begin{matrix}
	\mp |n| \\
	n_x \\
	n_y \\
	n_z 
\end{matrix} \right]$<br>
<br>

Combined:<br>
<br>

$\Lambda_A = \left[ \begin{matrix}
	-c \alpha |n| & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 \\
	0 & 0 & 0 & c \alpha |n|
\end{matrix} \right]$<br>
<br>

$R_A = \left[ \begin{matrix}
	|n| & 0			& 0			& -|n| \\
	n_x & (n_2)_x	& (n_3)_x	& n_x \\
	n_y & (n_2)_y	& (n_3)_y	& n_y \\
	n_z & (n_2)_z	& (n_3)_z	& n_z
\end{matrix} \right]$<br>
<br>

$L_A = (R_A)^{-1} = \left[ \begin{matrix}
	\frac{1}{2|n|} &
	\frac{1}{2|n|^2} n^x & 
	\frac{1}{2|n|^2} n^y & 
	\frac{1}{2|n|^2} n^z \\

	0 &
	\frac{1}{|n|^2} (n_2)^x & 
	\frac{1}{|n|^2} (n_2)^y & 
	\frac{1}{|n|^2} (n_2)^z \\
	
	0 &
	\frac{1}{|n|^2} (n_3)^x & 
	\frac{1}{|n|^2} (n_3)^y & 
	\frac{1}{|n|^2} (n_3)^z \\

	-\frac{1}{2|n|} &
	\frac{1}{2|n|^2} n^x & 
	\frac{1}{2|n|^2} n^y & 
	\frac{1}{2|n|^2} n^z \\
\end{matrix} \right]$<br>
<br>

Now since we have no change of basis from F to A we can say that $R_F = R_A$ and $L_F = L_A$<br>
<br>

Last, $\Lambda_F = \Lambda_A - c \beta_n I$<br>
<br>

$\Lambda_A = \left[ \begin{matrix}
	-c \beta_n -c \alpha |n| & 0 & 0 & 0 \\
	0 & -c \beta_n  & 0 & 0 \\
	0 & 0 & -c \beta_n  & 0 \\
	0 & 0 & 0 & -c \beta_n + c \alpha |n|
\end{matrix} \right]$<br>
<br>


<!--
FIXME:<br>
<hr>
<br>


Let's try that again but with volume element weighting:<br>
	
$\Phi_{,tt} - c^2 {\Phi_{;i}}^i = 0$<br>
Assuming $g_{ij}$ is not a function of $t$...<br>
$\Phi_{,tt} - \frac{1}{\sqrt{|g|}} (\sqrt{|g|} c^2 g^{ij} \Phi_{,i})_{,j} - \frac{1}{\sqrt{|g|}} {c^{ij}}_j \Phi_{,i} = 0$<br>
<br>
$\Pi_{,t} - \frac{1}{\sqrt{|g|}} (\sqrt{|g|} c^2 g^{ij} \Psi_i)_{,j} = \frac{1}{\sqrt{|g|}} {c^{ij}}_j \Phi_{,i}$<br>
$\Psi_{i,t} - \frac{1}{\sqrt{|g|}} (\sqrt{|g|} \Pi)_{,i} = -{\Gamma^j}_{ji} \Pi$<br>
<br>
$\left[\begin{matrix}
	\Pi \\ \Psi_i
\end{matrix}\right]_{,t}
+ \frac{1}{\sqrt{|g|}} \left(
	\sqrt{|g|} \cdot
	\left[\begin{matrix}
		0 & -c^2 g^{jk} \\
		-\delta^k_i & 0
	\end{matrix}\right] \left[\begin{matrix}
		\Pi \\ \Psi_j
	\end{matrix}\right]
\right)_{,k}
= \left[\begin{matrix}
	\frac{1}{\sqrt{|g|}} {c^{ij}}_j \Phi_{,i} \\ 
	-{\Gamma^j}_{ij} \Pi
\end{matrix}\right]$<br>
<br>

or, if you want to model the $\Phi_{,i}$ as a flux term,<br>
<br>

$\Phi_{,t} = \Pi$<br>
$\Pi_{,t} 
	- \frac{1}{\sqrt{|g|}} {c^{ij}}_j \Phi_{,i} 
	- \frac{1}{\sqrt{|g|}} (\sqrt{|g|} c^2 g^{ij} \Psi_i)_{,j} 
	= 0$<br>
$\Pi_{,t} 
	- \frac{1}{\sqrt{|g|}} (\sqrt{|g|} (c^2 g^{ij} \Psi_i + \frac{1}{\sqrt{|g|}} {c^{ji}}_i \Phi))_{,j} 
	= 
	- \frac{1}{\sqrt{|g|}} {c^{ij}}_{j,i} \Phi$<br>
$\Psi_{i,t} - \frac{1}{\sqrt{|g|}} (\sqrt{|g|} \Pi)_{,i} = -{\Gamma^j}_{ji} \Pi$<br>
<br>

$\left[\begin{matrix}
	\Phi \\ \Pi \\ \Psi_i
\end{matrix}\right]_{,t}
+ \frac{1}{\sqrt{|g|}} \left(
	\sqrt{|g|} \cdot
	\left[\begin{matrix}
		0 & 0 & 0 \\
		\frac{1}{\sqrt{|g|}} {c^{kj}}_j & 0 & -c^2 g^{jk} \\
		0 & -\delta^k_i & 0
	\end{matrix}\right] \left[\begin{matrix}
		\Phi \\ \Pi \\ \Psi_j
	\end{matrix}\right]
\right)_{,k}
= \left[\begin{matrix}
	\Pi \\ 
	\frac{1}{\sqrt{|g|}} {c^{kj}}_{j,k} \Phi \\ 
	-{\Gamma^j}_{ji} \Pi
\end{matrix}\right]$<br>


<hr>
<br>

How about changing the first-order variables?<br>

$\Pi = \Phi_{,t}$<br>
$\Psi_i = \sqrt{|g|} \Phi_{,i}$<br>
assuming a steady grid, so $g_{ij,t} = 0$<br>
<br>
$\Pi_{,t} - \frac{1}{\sqrt{|g|}} (c^2 g^{ij} \Psi_i)_{,j} = 0$<br>
$\Psi_{i,t} - \sqrt{|g|} \Pi_{,i} = 0$<br>
<br>

<hr>
<br>

$\Pi = \sqrt{|g|} \Phi_{,t}$<br>
$\Psi_i = \sqrt{|g|} \Phi_{,i}$<br>
$\Psi_{i,t} = \sqrt{|g|} \Phi_{,ti}$<br>
$\Psi_{i,t} = (\sqrt{|g|} \Phi_{,t})_{,i} - (\sqrt{|g|})_{,i} \Phi_{,t}$<br>
$\Psi_{i,t} - \Pi_{,i} = -\frac{1}{\sqrt{|g|}} (\sqrt{|g|})_{,i} \Pi$<br>
$\frac{1}{\sqrt{|g|}} \Pi_{,t} - \frac{1}{\sqrt{|g|}} (c^2 g^{ij} \Psi_i)_{,j} = 0$<br>
$\Pi_{,t} - (c^2 g^{ij} \Psi_i)_{,j} = 0$<br>
$\Psi_{i,t} - \Pi_{,i} = -{\Gamma^j}_{ji} \Pi$<br>
<br>
-->
	</body>
</html>
