<!doctype html>
<html>
	<head>
		<meta charset='utf-8'/>
		<title>MHD Worksheet</title>
		<script type="text/javascript" src='tryToFindMathJax.js'></script>
		<link rel='stylesheet' href='darkmode.css'></link>
		<script type='text/javascript' src='darkmode.js'></script>
	</head>
    <body>

<h2>Hydrodynamics</h2>

<h3>Mass</h3>

Total mass in volume:<br>
$m = \int_\Omega \rho dV$ = mass, in $[kg]$<br>
$\rho$ = density, in $[\frac{kg}{m^3}]$<br>
$\Omega$ = spatial domain, within $\textbf{R}^3$<br>
<br>

Rate-of-change of mass:<br>
$\partial_t m = \int_\Omega \partial_t \rho dV$, in $[\frac{kg}{s}]$<br>
<br>

Rate-of-change only considering boundary:<br>
$\partial_t m = \int_{\partial\Omega} \rho v^j dS_j$, in $[\frac{kg}{s}]$<br>
$v^i$ = velocity, in $[\frac{m}{s}]$<br>
<br>

Apply Green's theorem to rate-of-change of boundary:<br>
$\partial_t m = -\int_\Omega \nabla_j (\rho v^j) dV$ in $[\frac{kg}{s}]$<br>
<br>

Consider rate-of-change at any point:<br>
Conservation of mass:<br>
$\partial_t \rho + \nabla_j (\rho v^j) = 0$ in $[\frac{kg}{m^3 \cdot s}]$<br>
<br>

<h3>Momentum</h3>

Conservation of momentum:<br>
$\int_\Omega \Pi_C^i dV = \int_\Omega \rho v^i dV$ in $[\frac{kg \cdot m}{s}]$<br>
$\partial_t \int_\Omega \Pi_C^i dV$ = change in momentum due to conservation, in $[\frac{kg \cdot m}{s^2}]$<br>
<br>

Rate-of-change of momentum<br>
$\partial_t \int_\Omega \Pi_C^i dV = \int_\Omega \partial_t (\rho v^i) dV$, in $[\frac{kg \cdot m}{s^2}]$<br>
<br>

Rate-of-change of only considering boundary (neglecting forces like gravity, pressure, viscosity, etc)<br>
$\partial_t \int_\Omega \Pi_C^i dV = \int_{\partial\Omega} \rho v^i v^j dS_j$, in $[\frac{kg \cdot m}{s^2}]$<br>
<br>

Apply Green's theorem:<br>
$\partial_t \int_\Omega \Pi_C^i dV = -\int_\Omega \nabla_j (\rho v^i v^j) dV$, in $[\frac{kg \cdot m}{s^2}]$<br>
<br>

Consider at any point:<br>
(TODO this should either be a different symbol, (as $\rho$ relates to $m$), or annotation of like $\Pi$ vs $\tilde\Pi$).<br>
$\partial_t \Pi_C^i = -\nabla_j (\rho v^i v^j)$, in $[\frac{kg}{m^2 \cdot s^2}]$<br>
<br>

Hydro pressure from internal energy (ideal gas law):<br>
$P = (\gamma - 1) \rho e_{int} = (\gamma - 1) E_{int}$, in $[\frac{kg}{m \cdot s^2}]$<br>
$\gamma = $ heat capacity ratio, in $[1]$<br>
$P$ = hydro pressure, in $[\frac{kg}{m \cdot s^2}]$<br>
$e_{int}$ = specific internal energy per density, per volume, in $[\frac{m^2}{s^2}]$<br>
$E_{int}$ = internal energy per volume, in $[\frac{kg}{m \cdot s^2}]$<br>
<br>

internal energy, per volume:<br>
$E_{int} = \rho e_{int} = \frac{P}{\gamma - 1}$, in $[\frac{kg}{m \cdot s^2}]$<br>
<br>

Force due to pressure:<br>
$\partial_t \int_\Omega \Pi_P^i dV = \int_{\partial\Omega} P dS_i$, in $[\frac{kg \cdot m}{s^2}]$<br>
$\partial_t \int_\Omega \Pi_P^i dV = -\int_\Omega \nabla_i P dV$ via Green's theorem, in $[\frac{kg \cdot m}{s^2}]$<br>
$\partial_t \Pi_P^i = -\nabla_i P$ at any point, in $[\frac{kg}{m^2 \cdot s^2}]$<br>
<br>

Total change in momemtum:<br>
$\partial_t \Pi^i = \partial_t \Pi_C^i + \partial_t \Pi_P^i$, in $[\frac{kg}{m^2 \cdot s^2}]$<br>
$\partial_t \Pi^i = -\nabla_j (\rho v^i v^j) - \nabla_i P$, in $[\frac{kg}{m^2 \cdot s^2}]$<br>
$\partial_t \Pi^i + \nabla_j (\rho v^i v^j + g^{ij} P) = 0$, in $[\frac{kg}{m^2 \cdot s^2}]$<br>
... where $g^{ij}$ is the inverse metric tensor associated with our manifold tangent-space basis.<br>
<br>

$\partial_t \Pi^i + \nabla_j (\rho v^i v^j + g^{ij} P) = 0$, in $[\frac{kg}{m^2 \cdot s^2}]$<br>
<br>
For $\Pi^i = $ hydro momentum $ = \rho v^i$ we find<br>
$\partial_t (\rho v^i) + \nabla_j (\rho v^i v^j + g^{ij} P) = 0$, in $[\frac{kg}{m^2 \cdot s^2}]$<br>
<br>

<h3>Energy</h3>

specific kinetic energy, per density, per volume:<br>
$e_{kin} = \frac{1}{2} v^2$, in $[\frac{m^2}{s^2}]$<br>
... where $v^2 = v^i v^j g_{ij}$.<br>
<br>

kinetic energy, per volume:<br>
$E_{kin} = \rho e_{kin} = \frac{1}{2} \rho v^2$, in $[\frac{kg}{m \cdot s^2}]$<br>
<br>

Total hydro energy:<br>
$\int_\Omega E_{hydro} dV = \int_\Omega (E_{int} + E_{kin}) dV$, in $[\frac{kg \cdot m^2}{s^2}]$<br>
$\int_\Omega E_{hydro} dV = \int_\Omega (\frac{1}{2}\rho v^2 + \frac{P}{\gamma - 1}) dV$, in $[\frac{kg \cdot m^2}{s^2}]$<br>
<br>

change in total energy due to conservation of hydro energy:<br>
$\partial_t \int_\Omega E^C_{total} dV = \int_\Omega \partial_t E_{hydro} dV$, in $[\frac{kg \cdot m^2}{s^3}]$<br>
<br>

consider velocity moving through boundaries:<br>
$\partial_t \int_\Omega E^C_{total} dV = \int_{\partial\Omega} E_{hydro} v^i dS_i$, in $[\frac{kg \cdot m^2}{s^3}]$<br>
<br>

apply Green's theorem:<br>
$\partial_t \int_\Omega E^C_{total} dV = -\int_\Omega \nabla_j (E_{hydro} v^j) dV$, in $[\frac{kg \cdot m^2}{s^3}]$<br>
<br>

for any point:<br>
$\partial_t E^C_{total} = -\nabla_j (E_{hydro} v^j)$, in $[\frac{kg}{m \cdot s^3}]$<br>
<br>

Change in energy due to hydro pressure force:<br>
$\partial_t \int_\Omega E^P_{total} dV = \int_{\partial\Omega} P v^j dS_j$, in $[\frac{kg \cdot m^2}{s^3}]$<br>
$\partial_t \int_\Omega E^P_{total} dV = -\int_\Omega \nabla_j (P v^j) dV$ via Green's theorem, in $[\frac{kg \cdot m^2}{s^3}]$<br>
$\partial_t E^P_{total} = -\nabla_j (P v^j)$ at any point, in $[\frac{kg}{m \cdot s^3}]$<br>
<br>

Total change in total energy:<br>
$\partial_t E_{total} = \partial_t E^C_{total} + \partial_t E^P_{total}$, in $[\frac{kg}{m \cdot s^3}]$<br>
$\partial_t E_{total} = -\nabla_j (E_{hydro} v^j) - \nabla_j (P v^j)$, in $[\frac{kg}{m \cdot s^3}]$<br>
$\partial_t E_{total} + \nabla_j ((E_{hydro} + P) v^j) = 0$, in $[\frac{kg}{m \cdot s^3}]$<br>
$\partial_t E_{total} + \nabla_j (H_{hydro} v^j) = 0$, in $[\frac{kg}{m \cdot s^3}]$<br>
for $H_{hydro} = E_{hydro} + P$, in $[\frac{kg}{m \cdot s^2}]$<br>
<br>

<h3>Conservative form of Euler:</h3>

$\partial_t \rho + \nabla_j (\rho v^j) = 0$, in $[\frac{kg}{m^3 \cdot s}]$<br>
$\partial_t (\rho v^i) + \nabla_j (\rho v^i v^j + g^{ij} P) = 0$, in $[\frac{kg}{m^2 \cdot s^2}]$<br>
$\partial_t E_{hydro} + \nabla_j (H_{hydro} v^j) = 0$, in $[\frac{kg}{m \cdot s^3}]$<br>
<br>

the hyperbolic conservation law equation:<br>
$\partial_t U^I + \nabla_j F^{Ij} = 0$<br>
<br>

Euler fluid PDE conserved variables:<br>
$U^I = \downarrow I \left[\begin{matrix}
	\rho \\ \rho v^i \\ E_{hydro}
\end{matrix}\right]$<br>
<br>

Euler fluid PDE flux vector:<br>
$F^{Ij} = \downarrow I \left[\begin{matrix}
	\rho v^j \\
	\rho v^i v^j + g^{ij} P \\
	H_{hydro} v^j
\end{matrix}\right]$<br>
<br>

Euler fluid PDE primitive variables:<br>
$W^K = \downarrow K \left[\begin{matrix}
	\rho \\ v^k \\ P
\end{matrix}\right]$<br>
<br>

$\frac{\partial E_{hydro}}{\partial \rho}$
$= \frac{\partial}{\partial \rho} ( \frac{1}{2} \rho v^2 + \frac{P}{\gamma-1})$
$= \frac{1}{2} v^2$, in $[\frac{m^2}{s^2}]$<br>

$\frac{\partial E_{hydro}}{\partial v^k}$
$= \frac{\partial}{\partial v^k} ( \frac{1}{2} \rho v^2 + \frac{P}{\gamma-1})$
$= \rho v_k$, in $[\frac{kg}{m^2 \cdot s}]$<br>

$\frac{\partial E_{hydro}}{\partial P}$
$= \frac{\partial}{\partial P} ( \frac{1}{2} \rho v^2 + \frac{P}{\gamma-1})$
$= \frac{1}{\gamma-1}$, in $[1]$<br>
<br>

Derivative of conservatives wrt primitives:<br>
$\frac{\partial U^I}{\partial W^J} = \downarrow I \overset{\rightarrow J}{ \left[\begin{matrix}
	1 & 0 & 0 \\
	v^i & \rho \delta^i_j & 0 \\
	\frac{1}{2} v^2 & \rho v_j & \frac{1}{\gamma-1} 
\end{matrix}\right] }$<br>
<br>

Derivative of primitives wrt conservatives:<br>
$\frac{\partial W^J}{\partial U^I} = \downarrow J \overset{\rightarrow I}{ \left[\begin{matrix}
	1 & 0 & 0 \\
	-\frac{1}{\rho} v^j & \frac{1}{\rho} \delta_i^j & 0 \\
	\frac{1}{2} (\gamma-1) v^2 & -(\gamma-1) v_i & \gamma-1
\end{matrix}\right] }$<br>
<br>

Derivative of flux with respect to primitive variables:<br>
$\frac{\partial F^{Ij}}{\partial W^K} = \downarrow I \overset{\rightarrow K}{ \left[\begin{matrix}
	v^j & \rho \delta^j_k & 0 \\
	v^i v^j & \rho (\delta^i_k v^j + v^i \delta^j_k) & g^{ij} \\
	\frac{1}{2} v^2 v^j & \rho v^j v_k + H_{hydro} \delta^j_k & \frac{\gamma}{\gamma-1} v^j
\end{matrix}\right] }$<br>
<br>

Derivative of flux with respect to conservative variables:<br>
$\frac{\partial F^{Ij}}{\partial U^K} = \frac{\partial F^{Ij}}{\partial W^L} \frac{\partial W^L}{\partial U^K}
= \downarrow I \overset{\rightarrow L}{ \left[\begin{matrix}
	v^j & \rho \delta^j_l & 0 \\
	v^i v^j & \rho (\delta^i_l v^j + v^i \delta^j_l) & g^{ij} \\
	\frac{1}{2} v^2 v^j & \rho v^j v_l + (E_{hydro} + P) \delta^j_l & \frac{\gamma}{\gamma-1} v^j
\end{matrix}\right] } \cdot \downarrow L \overset{\rightarrow K}{ \left[\begin{matrix}
	1 & 0 & 0 \\
	-\frac{1}{\rho} v^l & \frac{1}{\rho} \delta^l_k & 0 \\
	\frac{1}{2} (\gamma-1) v^2 & -(\gamma-1) v_k & \gamma-1
\end{matrix}\right] }$<br>
$= \downarrow I \overset{\rightarrow K}{ \left[\begin{matrix}
	0 & \delta^j_k & 0 \\
	-v^i v^j + \frac{1}{2} g^{ij} (\gamma-1) v^2 &
		\delta^i_k v^j + \delta^j_k v^i - g^{ij} (\gamma-1) v_k &
		g^{ij} (\gamma - 1) \\
	\frac{1}{2} v^j v^2 (\gamma - 1) - v^j h_{hydro} &
		-(\gamma-1) v^j v_k + \delta^j_k h_{hydro} &
		\gamma v^j
\end{matrix}\right] }$<br>
<br>
for $h_{hydro} = \frac{1}{\rho} H_{hydro}$, in $[\frac{m^2}{s^2}]$<br>
<br>

<h2>Magnetohydrodynamics</h2>

$\mu_0 = $ permeability of free space, in $[\frac{kg \cdot m}{C^2}]$<br>
$\epsilon_0 = $ permittivity of free space, in $[\frac{C^2 \cdot s^2}{kg \cdot m^3}]$<br>
$E = $ electrical field, in $[\frac{kg \cdot m}{C \cdot s^2}]$<br>
$B = $ magnetic field, in $[\frac{kg}{C \cdot s}]$<br>
$J = $ electrical current, per volume, in $[\frac{C}{m^2 \cdot s}]$<br>
<br>

Ampere's law:<br>
$\vec{\nabla} \times \vec{B} = \mu_0 (\vec{J} + \epsilon_0 \partial_t \vec{E})$, in $[\frac{kg}{C \cdot m \cdot s}]$<br>
${\epsilon^{ij}}_k \nabla_j B^k = \mu_0 (J^i + \epsilon_0 \partial_t E^i)$, in $[\frac{kg}{C \cdot m \cdot s}]$<br>
Assume that our electric field is a steady-state, i.e. $\partial_t E^i = 0$<br>
$J^i = \frac{1}{\mu_0} {\epsilon^{ij}}_k \nabla_j B^k$, in $[\frac{C}{m^2 \cdot s}]$<br>
<br>

$q = $ electric charge, in $[C]$<br>
$\sigma$ = electrical conductivity, in $[\frac{C^2 \cdot s^2}{kg \cdot m^3 \cdot s}]$<br>
<br>

Lorentz force law:<br>
$\vec{F} = q (\vec{E} + \vec{v} \times \vec{B})$, in $[\frac{kg \cdot m}{s^2}]$<br>
$F^i = q (E^i + {\epsilon^i}_{jk} v^j B^k)$, in $[\frac{kg \cdot m}{s^2}]$<br>
$E^i = \frac{1}{q} F^i - {\epsilon^i}_{jk} v^j B^k$, in $[\frac{kg \cdot m}{C \cdot s^2}]$<br>
Let $J^i / \sigma = F^i / q$, in $[\frac{kg \cdot m}{C \cdot s^2}]$<br>
$E^i = J^i / \sigma - {\epsilon^i}_{jk} v^j B^k$, in $[\frac{kg \cdot m}{C \cdot s^2}]$<br>
<br>

Maxwell-Faraday equation:<br>
$\partial_t \vec{B} = -\vec{\nabla} \times \vec{E}$<br>
$\partial_t B^i = -{\epsilon^{ij}}_k \nabla_j E^k$<br>
<br>

(TODO flip valence of everything below here, to make it match my other EMHD flux eigensystem worksheets ... and double check or just use those).<br>
<h3>Magnetic Field</h3>

substitute Ampere's law into Lorentz force law:<br>
$E^i = \frac{1}{\sigma\mu_0} {\epsilon^{ij}}_k \nabla_j B^k - {\epsilon^i}_{jk} v^j B^k$<br>
$\eta = \frac{1}{\sigma\mu_0} = $ magnetic diffusivity<br>
$E^i = \eta {\epsilon^{ij}}_k \nabla_j B^k - {\epsilon^i}_{jk} v^j B^k$<br>
<br>

substitute this into Maxwell-Faraday equation:<br>
$ \partial_t B_i = -{\epsilon_i}^{jk} \nabla_j (\eta {\epsilon_k}^{lm} \partial_l B_m - {\epsilon_k}^{lm} v_l B_m)$<br>
$ \partial_t B_i = {\epsilon_i}^{jk} {\epsilon_k}^{lm} \nabla_j (v_l B_m) - {\epsilon_i}^{jk} {\epsilon_k}^{lm} \nabla_j (\eta \partial_l B_m)$<br>
Levi-Civita identity: ${\epsilon_i}^{jk} {\epsilon_k}^{lm} = \delta^{ij}_{kl} = \delta^i_k \delta^j_l - \delta^i_l \delta^j_k$<br>
$ \partial_t B_i = (\delta^i_l \delta^j_m - \delta^i_m \delta^j_l) \nabla_j (v_l B_m) - (\delta^i_l \delta^j_m - \delta^i_m \delta^j_l) \nabla_j (\eta \partial_l B_m)$<br>
assume $\eta$ is constant<br>
$ \partial_t B_i = \nabla_j (v_i B_j - v_j B_i) - \eta (\nabla_i \nabla_j B_j - \nabla_j \nabla_j B_i)$<br>
No magnetic monopoles: $\nabla_i B_i = 0$<br>
$ \partial_t B_i = \nabla_j (v_i B_j - v_j B_i) + \eta \nabla_j \nabla_j B_i$<br>
assume $\eta = 0$<br>
$ \partial_t B_i = \nabla_j (v_i B_j - v_j B_i)$<br>
$ \partial_t B_i + \nabla_j (B_i v_j - B_j v_i) = 0$<br>

<h3>Momentum</h3>

Lorentz force law:<br>
$F_i = q (E_i + {\epsilon_i}^{jk} v_j B_k)$<br>
assume $E_i = 0$<br>
$\Pi^M_i = F_i =$ Magnetic force on fluid<br>
$\Pi^M_i = {\epsilon_i}^{jk} q v_j B_k$<br>
let $J_i = q v_i$<br>
$\Pi^M_i = {\epsilon_i}^{jk} J_j B_k$<br>
substitute Ampere's law approximation: $J_i = \frac{1}{\mu_0} {\epsilon_i}^{jk} \nabla_j B_k$<br>
$\Pi^M_i = {\epsilon_i}^{jk} (\frac{1}{\mu_0} {\epsilon_j}^{lm} \partial_l B_m) B_k$<br>
$\Pi^M_i = -\frac{1}{\mu_0} {\epsilon_i}^{kj} {\epsilon^{lm}}_j B_k \partial_l B_m$<br>
$\Pi^M_i = \frac{1}{\mu_0} (\delta^i_m \delta^k_l - \delta^i_l \delta^k_m) B_k \partial_l B_m$<br>
$\Pi^M_i = \frac{1}{\mu_0} (B_j \nabla_j B_i - B_j \nabla_i B_j)$<br>
insert additional $\nabla_k B_k = 0$ terms, split $B_j \nabla_i B_j$ into two halves<br>
$\Pi^M_i = \frac{1}{\mu_0} ((\nabla_j B_i) B_j + B_i (\nabla_j B_j) - B_i - \frac{1}{2} (\nabla_i B_j) B_j  - \frac{1}{2} B_j (\nabla_i B_j))$<br>
un-distribute gradient:<br> 
$\Pi^M_i = \frac{1}{\mu_0} (\nabla_j (B_i B_j) - \frac{1}{2} \nabla_i (B^2))$<br>
$\Pi^M_i = \nabla_j (\frac{1}{\mu_0} (B_i B_j - \frac{1}{2} g^{ij} B_i B_j))$<br>
$\Pi^M_i = \nabla_j \sigma_{ij}$<br>
$\sigma_{ij} = \frac{1}{\mu_0} (B_i B_j - \frac{1}{2} g^{ij} B_i B_j) =$ Maxwell stress tensor for $E_i = 0$<br>
<br>
Change in momentum due to magnetic field:<br>
$\Pi^M_i = -\frac{1}{2} \frac{1}{\mu_0} \nabla_j B^2 + \frac{1}{\mu_0} \nabla_j (B_i B_j)$<br>
<br>

Total change in momemtum:<br>
$\partial_t \Pi_i = \partial_t \Pi^C_i + \partial_t \Pi^P_i + \partial_t \Pi^M_i$<br>
$\partial_t \Pi_i = -\nabla_j (\rho v_i v_j) - \nabla_i P - \frac{1}{\mu_0} \frac{1}{2} \nabla_i B^2 + \frac{1}{\mu_0} \nabla_j (B_i B_j)$<br>
$\partial_t \Pi_i + \nabla_j (\rho v_i v_j + g^{ij} P + \frac{1}{\mu_0} \frac{1}{2} g^{ij} B^2 - \frac{1}{\mu_0} B_i B_j) = 0$<br>
<br>

Let $P_{mag} = \frac{1}{\mu_0} \frac{1}{2} B^2$<br>
$\partial_t \Pi_i + \nabla_j (\rho v_i v_j + g^{ij} (P + P_{mag}) - \frac{1}{\mu_0} B_i B_j) = 0$<br>
<br>
Let $P_{total} = P + P_{mag}$<br>
$\partial_t \Pi_i + \nabla_j (\rho v_i v_j + g^{ij} P_{total} - \frac{1}{\mu_0} B_i B_j) = 0$<br>
<br>
For $\Pi_i = $ total momentum $ = \rho v_i$ we find<br>
$\partial_t (\rho v_i) + \nabla_j (\rho v_i v_j + g^{ij} P_{total} - \frac{1}{\mu_0} B_i B_j) = 0$<br>

<h3>Energy</h3>

Change in energy due to magnetic field:<br>
$\partial_t E_{total}^M = -\int_{\partial\Omega} B_k (v_k B_j - v_j B_k) dS_j$ <b>TODO</b> where does this come from? I'm guessing $\partial_t B_i$<br>
$\partial_t E_{total}^M = \int_\Omega \nabla_j (B_k (v_k B_j - v_j B_k)) dV$ via Green's theorem<br>
$\partial_t E_{total}^M = \nabla_j (B_k (v_k B_j - v_j B_k))$ at any point<br>
<br>

Total change in total energy:<br>
$\partial_t E_{total} = \partial_t E_{total}^C + \partial_t E_{total}^P + \partial_t E_{total}^M$<br>
$\partial_t E_{total} = -\nabla_j (E_{hydro} v_j) - \nabla_j (P v_j) - \nabla_j \frac{1}{\mu_0} (v_j B^2 - B_k v_k B_j)$<br>
$\partial_t E_{total} + \nabla_j ((E_{hydro} + P) v_j + \frac{1}{\mu_0} (v_j B^2 - B_k v_k B_j) = 0$<br>
$\partial_t E_{total} + \nabla_j ((E_{hydro} + P) v_j + \frac{1}{\mu_0} B_k (v_j B_k - v_k B_j)) = 0$<br>
$\partial_t E_{total} + \nabla_j ((E_{hydro} + P) v_j + \frac{1}{\mu_0} B^2 v_j - \frac{1}{\mu_0} B_k v_k B_j) = 0$<br>
$\partial_t E_{total} + \nabla_j ((E_{hydro} + \frac{1}{2} \frac{1}{\mu_0} B^2 + P + \frac{1}{2} \frac{1}{\mu_0} B^2) v_j - \frac{1}{\mu_0} B_k v_k B_j) = 0$<br>
<br>

Let $E_{mag} = \frac{1}{2} \frac{1}{\mu_0} B^2$<br>
$\partial_t E_{total} + \nabla_j ((E_{hydro} + E_{mag} + P + P_{mag}) v_j - \frac{1}{\mu_0} B_k v_k B_j) = 0$<br>
<br>

Let $E_{total} = E_{hydro} + E_{mag}$<br>
Let $H_{total} = E_{total} + P_{total}$<br>
$\partial_t E_{total} + \nabla_j (H_{total} v_j - \frac{1}{\mu_0} B_k v_k B_j) = 0$<br>

<h2>Conservative Form of MHD:</h2>

$\partial_t \rho + \nabla_j (\rho v_j) = 0$<br>
$\partial_t (\rho v_i) + \nabla_j (\rho v_i v_j + g^{ij} P_{total} - \frac{1}{\mu_0} B_i B_j) = 0$<br>
$\partial_t B_i + \nabla_j (B_i v_j - B_j v_i) = 0$<br>
$\partial_t E_{total} + \nabla_j (H_{total} v_j - \frac{1}{\mu_0} B_k v_k B_j) = 0$<br>
<br>

$\partial_t U_i + \partial_{x_j} F_{ij} = 0$<br>
<br>

Primitive variables:<br>
$W_i \left[\begin{matrix}
	\rho \\ v_i \\ B_i \\ P
\end{matrix}\right]$<br>
<br>

Conservative variables:<br>
$U_i = \left[\begin{matrix}
	\rho \\ \rho v_i \\ B_i \\ E_{total}
\end{matrix}\right]$<br>
<br>

$\frac{\partial E_{total}}{\partial \rho}$<br>
$= \frac{\partial E_{hydro}}{\partial \rho} + \frac{\partial E_{mag}}{\partial \rho}$<br>
$= \frac{1}{2} v^2$<br>
$\frac{\partial E_{total}}{\partial v_k}$<br>
$= \frac{\partial E_{hydro}}{\partial v_k} + \frac{\partial E_{mag}}{\partial v_k}$<br>
$= \rho v_k$<br>
$\frac{\partial E_{total}}{\partial B_k}$<br>
$= \frac{\partial E_{hydro}}{\partial B_k} + \frac{\partial E_{mag}}{\partial B_k}$<br>
$= \frac{1}{\mu_0} B_k$<br>
$\frac{\partial E_{total}}{\partial P}$<br>
$= \frac{\partial E_{hydro}}{\partial P} + \frac{\partial E_{mag}}{\partial P}$<br>
$= \frac{1}{\gamma-1} $<br>
<br>

Derivative of conservative with respect to primitive:<br>
$\frac{\partial U_i}{\partial W_j} = \downarrow I \overset{\rightarrow J}{ \left[\begin{matrix}
	1 & 0 & 0 & 0 \\ 
	v_i & \rho g^{ij} & 0 & 0 \\
	0 & 0 & g^{ij} & 0 \\
	\frac{1}{2}v^2 & \rho v_j & \frac{1}{\mu_0} B_j & \frac{1}{\gamma-1}
\end{matrix}\right] }$<br>
<br>

Derivative of primitive with respect to conservative:<br>
$\frac{\partial W_j}{\partial U_i} = \downarrow J \overset{\rightarrow L}{ \left[\begin{matrix}
	1 & 0 & 0 & 0 \\ 
	-\frac{1}{\rho} v_j & \frac{1}{\rho} g^{ij} & 0 & 0 \\
	0 & 0 & g^{ij} & 0 \\
	\frac{1}{2} (\gamma-1) v^2 & -(\gamma-1) v_i & -(\gamma-1) \frac{1}{\mu_0} B_i & \gamma-1
\end{matrix}\right] }$<br>
<br>

Flux vector:<br>
$F_{ij} = \left[\begin{matrix}
	\rho v_j \\
	\rho v_i v_j + g^{ij} P_{total} - \frac{1}{\mu_0} B_i B_j \\
	B_i v_j - B_j v_i \\
	H_{total} v_j - \frac{1}{\mu_0} B_k v_k B_j
\end{matrix}\right]$<br>
<br>

Derivative of flux vector with respect to primitive variables:<br>
$\frac{\partial F_{ij}}{\partial W_k} = \downarrow I \overset{\rightarrow K}{ \left[\begin{matrix}
	v_j & 
		\rho g^{jk} &
		0 &
		0 \\
	v_i v_j &
		\rho (g^{ik} v_j + v_i g^{jk}) &
		\frac{1}{\mu_0} (g^{ij} B_k - g^{ik} B_j - g^{jk} B_i) &
		g^{ij} \\
	0 &
		B_i g^{jk} - B_j g^{ik} &
		g^{ik} v_j - g^{jk} v_i &
		0 \\
	\frac{1}{2} v^2 v_j &
		\rho v_j v_k + H_{total} g^{jk} - \frac{1}{\mu_0} B_j B_k &
		\frac{1}{\mu_0} (2 B_k v_j - v_k B_j - g^{jk} v_l B_l) &
		\frac{\gamma}{\gamma-1} v_j
\end{matrix}\right] }$<br>
<br>

Derivative of flux vector with respect to conservative variables:<br>
$\frac{\partial F_{ij}}{\partial U_k}
= \frac{\partial F_{ij}}{\partial W_l} \frac{\partial W_l}{\partial U_k}$<br>
$= \downarrow I \overset{\rightarrow L}{ \left[\begin{matrix}
	v_j & 
		\rho g^{jl} &
		0 &
		0 \\
	v_i v_j &
		\rho (g^{il} v_j + v_i g^{jl}) &
		\frac{1}{\mu_0} (g^{ij} B_l - g^{il} B_j - g^{jl} B_i) &
		g^{ij} \\
	0 &
		B_i g^{jl} - B_j g^{il} &
		g^{il} v_j - g^{jl} v_i &
		0 \\
	\frac{1}{2} v^2 v_j &
		\rho v_j v_l + (E_{hydro} + \frac{1}{\mu_0} B^2 + P) g^{jl} - \frac{1}{\mu_0} B_j B_l &
		\frac{1}{\mu_0} (2 B_l v_j - v_l B_j - g^{jl} v_m B_m) &
		\frac{\gamma}{\gamma-1} v_j
\end{matrix}\right] } \cdot \downarrow L \overset{\rightarrow K}{ \left[\begin{matrix}
	1 & 0 & 0 & 0 \\ 
	-\frac{1}{\rho} v_l & \frac{1}{\rho} g^{kl} & 0 & 0 \\
	0 & 0 & g^{kl} & 0 \\
	\frac{1}{2} (\gamma-1) v^2 & -(\gamma-1) v_k & -(\gamma-1) \frac{1}{\mu_0} B_k & \gamma-1
\end{matrix}\right] }$<br>
$= \downarrow I \overset{\rightarrow K}{ \left[\begin{matrix}
	0 &
		g^{jk} &
		0 &
		0 \\
	-v_i v_j + \frac{1}{2} g^{ij} (\gamma-1) v^2 &
		g^{ik} v_j + g^{jk} v_i - g^{ij} (\gamma-1) v_k &
		\frac{1}{\mu_0}(-g^{ij} (\gamma-2) B_k - g^{ik} B_j - g^{jk} B_i) &
		g^{ij} (\gamma-1) \\
	-\frac{1}{\rho} (B_i v_j - B_j v_i) &
		\frac{1}{\rho} (B_i g^{jk} - B_j g^{ik}) &
		g^{ik} v_j - g^{jk} v_i &
		0 \\
	v_j (\frac{1}{2} (\gamma-1) v^2 - h_{total}) + \frac{1}{\mu_0\rho} B_j B_m v_m &
		-(\gamma-1) v_j v_k + (g^{jk} h_{total} - \frac{1}{\mu_0\rho} B_j B_k) &
		\frac{1}{\mu_0} (-(\gamma - 2) v_j B_k - v_k B_j - g^{jk} v_m B_m) &
		\gamma v_j
\end{matrix}\right] }$<br>
<br>

for $h_{total} = (E_{total} + P_{total}) / \rho$<br>
<br>

<h3>Similarity Transforms:</h3>

$\partial_t U_i(x,t) + \partial_{x_j} F_{ij}(U(x,t)) = 0$<br>
<br>
substitute $\tilde{F}_{ij}$ and $\tilde{U}_i$ into conservative equations<br>
$\partial_t \tilde{U}_i + \partial_{x_j} (\tilde{F}_{ij} + \xi_j \tilde{U}_i) = 0$<br>
<br>
time derivative of state (in self-similar form)<br>
$\partial_t \tilde{U}_i = {\partial\tilde{U}_i\over\partial\xi_j} {\partial\xi_j\over\partial t} = -{x_j\over t^2} \partial_{\xi_j} \tilde{U}_i$<br>
substitute $\xi_j = {x_j\over t}$<br>
$\partial_t \tilde{U}_i = -{1\over t} \xi_j \partial_{\xi_j} \tilde{U}_i$<br>
<br>
spatial derivative of flux (in self-similar form)<br>
$\partial_{x_j} F_{ij} = \partial_{x_j} (\tilde{F}_{ij} + \xi_j \tilde{U}_i)$<br>
$= {{\partial \xi_j}\over{\partial x_j}} \partial_{\xi_j} (\tilde{F}_{ij} + \xi_j \tilde{U}_i)$<br>
$= {1\over t} (\partial_{\xi_j} \tilde{F}_{ij} + (\partial_{\xi_j} \xi_j) \tilde{U}_i + \xi_j \partial_{\xi_j} \tilde{U}_i)$<br>
$= {1\over t} (\partial_{\xi_j} \tilde{F}_{ij} + n \tilde{U}_i) + {1\over t} \xi_j \partial_{\xi_j} \tilde{U}_i$ for $n$ dimensions<br>

substitute to find:<br>
$ -{1\over t} \xi_j \partial_{\xi_j} \tilde{U}_i
	+ {1\over t} (\partial_{\xi_j} \tilde{F}_{ij} + n \tilde{U}_i) + {1\over t} \xi_j \partial_{\xi_j} \tilde{U}_i = 0$<br>
<br>

simplifies to<br>
$n \tilde{U}_i + \partial_{\xi_j} \tilde{F}_{ij} = 0$<br>
<br>

finite volume form:<br>
$\int_\Omega (n \tilde{U}_i + \partial_{\xi_j} \tilde{F}_{ij}) dx = 0$<br>
$\int_\Omega dx n \tilde{U}_i + \int_\Omega \partial_{\xi_j} \tilde{F}_{ij} dx = 0$<br>
$|\Omega| n \tilde{U}_i + \int_{\partial\Omega} \tilde{F}_{ij} n_j d\sigma = 0$<br>
discretize:<br>
$\Delta \xi n \tilde{U}_i + \tilde{F}_{ij}(x_R) - \tilde{F}_{ij}(x_L) = 0$<br>
$n \tilde{U}_i + {1\over\Delta \xi}(\tilde{F}_{ij}(x_R) - \tilde{F}_{ij}(x_L)) = 0$<br>
...for $\Delta \xi = \Pi_{k=1}^n \Delta \xi_k$<br>

<h3>Similarity Transform of MHD Equations:</h3>

$U_i = \tilde{U}_i = \left[\begin{matrix}
	\rho \\ \rho v_i \\ B_i \\ E_{total} 
\end{matrix}\right]$<br>
<br>
$F_{ij} = \left[\begin{matrix}
	\rho v_j \\ 
	\rho v_i v_j + g^{ij} P_{total} - \frac{1}{\mu_0} B_i B_j \\ 
	B_i v_j - B_j v_i \\ 
	(E_{total} + P_{total}) v_j - \frac{1}{\mu_0} B_k v_k B_j
\end{matrix}\right]$<br>
<br>
$\tilde{F}_{ij} = F_{ij} - \xi_j \tilde{U}_i = \left[\begin{matrix}
	\rho (v_j - \xi_j) \\ 
	\rho v_i (v_j - \xi_j) + g^{ij} P_{total} - \frac{1}{\mu_0} B_i B_j \\ 
	B_i (v_j - \xi_j) - B_j v_i \\ 
	E_{total} (v_j - \xi_j) + P_{total} v_j - \frac{1}{\mu_0} B_k v_k B_j 
\end{matrix}\right]$<br>

<h3>Newton Method</h3>

Nonlinear function:<br>
$G_i(\tilde{U}) = n \tilde{U}_i + \partial_{\xi_j} \tilde{F}_{ij}$<br>
solve for $G_i = 0$ by minimizing $\tilde{U}_j$<br>
<br>
Taylor expansion of function to minimize:<br>
$G_i(\tilde{U}^{k+1}) = G_i(\tilde{U}^k) + {{\partial G_i(\tilde{U}^k)}\over{\partial \tilde{U}^k_j}} (\tilde{U}_j^{k+1} - \tilde{U}_j^k) + \mathscr(O)((\tilde{U})^2)$<br>
$\tilde{U}_i^k$ the $k$th iteration of our state vector $\tilde{U}_i$<br>
$G_i(\tilde{U}^{k+1}) = G_i(\tilde{U}^k) + {{\partial G_i(\tilde{U}^k)}\over{\partial \tilde{U}^k_j}} (\tilde{U}_j^{k+1} - \tilde{U}_j^k) + \mathscr(O)((\tilde{U})^2)$<br>
<br>
Rearranged, and ignoring the higher-order terms:<br>
$||{{\partial G_i(\tilde{U}^k)}\over{\partial \tilde{U}^k_j}}||^{-1}_{ij} (G_j(\tilde{U}^{k+1}) - G_j(\tilde{U}^k)) = \tilde{U}_i^{k+1} - \tilde{U}_i^k$<br>
$\tilde{U}_i^{k+1} = \tilde{U}_i^k + ||{{\partial G_i(\tilde{U}^k)}\over{\partial \tilde{U}^k_j}}||^{-1}_{ij} (G_j(\tilde{U}^{k+1}) - G_j(\tilde{U}^k))$<br>
Assume that we arrive at our destination, i.e. $G_i(\tilde{U}^{k+1}) = 0$:<br>
$\tilde{U}_i^{k+1} = \tilde{U}_i^k - ||{{\partial G_i(\tilde{U}^k)}\over{\partial \tilde{U}^k_j}}||^{-1}_{ij} G_j(\tilde{U}^k)$<br>
This formula is equivalent to Newton's method of an n-dimensions scalar function with value equal to $\frac{1}{2}||G||^2$<br>
<br>
Jacobian Approximation:<br>
${{\partial G_i(u)}\over{\partial \tilde{U}_j}} v_j \approx ( G_i (u + \epsilon v) - G_i(u) ) / \epsilon$<br>
<br>
Evaluation of function to minimize<br> 
${{\partial G_i}\over{\partial \tilde{U}_j}} = \partial_{\tilde{U}_j} G_i$<br>
$= \partial_{\tilde{U}_j} (n \tilde{U}_i + \partial_{\xi_k} \tilde{F}_{ik})$<br>
$= n g^{ij} + \partial_{\tilde{U}_j} \partial_{\xi_k} \tilde{F}_{ik}$<br>
<br>

<h3>Curved Space Partial of Conserved Quantities wrt Primitives</h3><br>
$U^I = \left[\begin{matrix}
	\rho \\
	m^i \\
	B^i \\
	E_{total}
\end{matrix}\right] = \left[\begin{matrix}
	\rho \\
	\rho v^i \\
	B^i \\
	\tilde\gamma^{-1} P + \frac{1}{2} \rho v^2 + \frac{1}{2} \frac{1}{\mu_0} B^2
\end{matrix}\right]$<br>
<br>

$E_{total} = E_{int} + E_{kin} + E_{mag}$<br>
$= \tilde\gamma^{-1} P + \frac{1}{2} \rho v^2 + \frac{1}{2} \frac{1}{\mu_0} B^2$<br>
$P = \tilde\gamma (E_{total} - \frac{1}{2} \rho v^2 - \frac{1}{2} \frac{1}{\mu_0} B^2)$<br>
$P_{total} = P + P_{mag} = \tilde\gamma (E_{total} - \frac{1}{2} \rho v^2 - \frac{1}{2} \frac{1}{\mu_0} B^2) + \frac{1}{2} \frac{1}{\mu_0} B^2$<br>
$= \tilde\gamma E_{total} 
	- \frac{1}{2} \tilde\gamma \rho v^2 
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 
$<br>
$H_{total} = E_{total} + P_{total}$<br>
$= \gamma E_{total} 
	- \frac{1}{2} \tilde\gamma \rho v^2 
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 
$<br>

<br>

$F^{Ij}$<br>
$= \left[\begin{matrix}
	\rho v^j \\
	\rho v^i v^j + g^{ij} P_{total} - \frac{1}{\mu_0} B^i B^j \\
	B^i v^j - B^j v^i \\
	H_{total} v^j - \frac{1}{\mu_0} B^k v_k B^j
\end{matrix}\right]$<br>

$= \left[\begin{matrix}
	m^j \\
	\frac{1}{\rho} m^i m^j + g^{ij} (\tilde\gamma (E_{total} - \frac{1}{2} \frac{1}{\rho} m^2 - \frac{1}{2} \frac{1}{\mu_0} B^2) + \frac{1}{2} \frac{1}{\mu_0} B^2) - \frac{1}{\mu_0} B^i B^j \\
	\frac{1}{\rho} (B^i m^j - B^j m^i) \\
	\frac{1}{\rho} (E_{total} + \tilde\gamma (E_{total} - \frac{1}{2} \frac{1}{\rho} m^2 - \frac{1}{2} \frac{1}{\mu_0} B^2) + \frac{1}{2} \frac{1}{\mu_0} B^2) m^j - \frac{1}{\mu_0} \frac{1}{\rho} B^k m_k B^j
\end{matrix}\right]$<br>

$= \left[\begin{matrix}
	m^j 
	\\
	
	+ \frac{1}{\rho} m^i m^j 
	- \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^2 g^{ij}
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 g^{ij}
	- \frac{1}{\mu_0} B^i B^j 
	+ \tilde\gamma g^{ij} E_{total} 
	\\
	
	+ \frac{1}{\rho} B^i m^j 
	- \frac{1}{\rho} B^j m^i
	\\
	
	- \frac{1}{2} \tilde\gamma \frac{1}{\rho^2} m^j m^2 
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} \frac{1}{\rho} m^j B^2
	- \frac{1}{\mu_0} \frac{1}{\rho} B^k m^l g_{kl} B^j
	+ \frac{1}{\rho} \gamma m^j E_{total} 
\end{matrix}\right]$<br>

<br>

Flux partial derivative:<br>
<br>
${F^{Ij}}_{,j}$<br>
$= \left[\begin{matrix}
	m^j 
	\\
	
	+ \frac{1}{\rho} m^i m^j 
	- \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^2 g^{ij}
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 g^{ij}
	- \frac{1}{\mu_0} B^i B^j 
	+ \tilde\gamma g^{ij} E_{total} 
	\\
	
	+ \frac{1}{\rho} B^i m^j 
	- \frac{1}{\rho} B^j m^i
	\\
	
	- \frac{1}{2} \tilde\gamma \frac{1}{\rho^2} m^j m^2 
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} \frac{1}{\rho} m^j B^2
	- \frac{1}{\mu_0} \frac{1}{\rho} B^k m^l g_{kl} B^j
	+ \frac{1}{\rho} \gamma m^j E_{total} 
\end{matrix}\right]_{,j}$<br>

$= \left[\begin{matrix}
	{m^j}_{,j}
	\\
	
	- \frac{1}{\rho^2} \rho_{,j} m^i m^j 
	+ \frac{1}{\rho} {m^i}_{,j} m^j 
	+ \frac{1}{\rho} m^i {m^j}_{,j}
	
	+ \frac{1}{2} \tilde\gamma \frac{1}{\rho^2} \rho_{,j} m^2 g^{ij}
	- \tilde\gamma \frac{1}{\rho} {m^k}_{,j} m_k g^{ij}
	- \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^k m^l g_{kl,j} g^{ij}
	- \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^2 {g^{ij}}_{,j}
	
	+ (2 - \gamma) \frac{1}{\mu_0} {B^k}_{,j} B_k g^{ij}
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^k B^l g_{kl,j} g^{ij}
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 {g^{ij}}_{,j}
	
	- \frac{1}{\mu_0} {B^i}_{,j} B^j 
	- \frac{1}{\mu_0} B^i {B^j}_{,j}
	
	+ \tilde\gamma {g^{ij}}_{,j} E_{total} 
	+ \tilde\gamma g^{ij} E_{total,j}
	\\
	
	- \frac{1}{\rho^2} \rho_{,j} B^i m^j 
	+ \frac{1}{\rho} {B^i}_{,j} m^j 
	+ \frac{1}{\rho} B^i {m^j}_{,j}
	
	+ \frac{1}{\rho^2} \rho_{,j} B^j m^i
	- \frac{1}{\rho} {B^j}_{,j} m^i
	- \frac{1}{\rho} B^j {m^i}_{,j}
	\\
	
	+ \tilde\gamma \frac{1}{\rho^3} \rho_{,j} m^j m^2 
	- \frac{1}{2} \tilde\gamma \frac{1}{\rho^2} {m^j}_{,j} m^2 
	- \tilde\gamma \frac{1}{\rho^2} m^j {m^k}_{,j} m_k
	- \frac{1}{2} \tilde\gamma \frac{1}{\rho^2} m^j m^k m^l g_{kl,j}

	- \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} \frac{1}{\rho^2} \rho_{,j} m^j B^2
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} \frac{1}{\rho} {m^j}_{,j} B^2
	+ (2 - \gamma) \frac{1}{\mu_0} \frac{1}{\rho} m^j {B^k}_{,j} B_k
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} \frac{1}{\rho} m^j B^k B^l g_{kl,j}

	+ \frac{1}{\mu_0} \frac{1}{\rho^2} \rho_{,j} B^k m^l g_{kl} B^j
	- \frac{1}{\mu_0} \frac{1}{\rho} {B^k}_{,j} m^l g_{kl} B^j
	- \frac{1}{\mu_0} \frac{1}{\rho} B^k {m^l}_{,j} g_{kl} B^j
	- \frac{1}{\mu_0} \frac{1}{\rho} B^k m^l g_{kl,j} B^j
	- \frac{1}{\mu_0} \frac{1}{\rho} B^k m^l g_{kl} {B^j}_{,j}
	
	
	- \gamma \frac{1}{\rho^2} \rho_{,j} m^j E_{total} 
	+ \gamma \frac{1}{\rho} {m^j}_{,j} E_{total} 
	+ \gamma \frac{1}{\rho} m^j E_{total,j} 
\end{matrix}\right]$<br>

$= \left[\begin{matrix}
	0 &
	\delta^j_k &
	0 & 
	0 \\

	\frac{1}{\rho^2} (
		- m^i m^j 
		+ \frac{1}{2} \tilde\gamma m^2 g^{ij}
	) &

	\frac{1}{\rho} (
		m^j \delta^i_k
		+ m^i \delta^j_k
		- \tilde\gamma m_k g^{ij}
	) &

	\frac{1}{\mu_0} (
		(2 - \gamma) B_k g^{ij}
		- B^j \delta^i_k
		- B^i \delta^j_k
	) &

	\tilde\gamma g^{ij}
	\\

	\frac{1}{\rho^2} (
		- B^i m^j 
		+ B^j m^i
	) &

	\frac{1}{\rho} (
		B^i \delta^j_k
		- B^j \delta^i_k
	) &

	\frac{1}{\rho} (
		m^j \delta^i_k
		- m^i \delta^j_k
	) &

	0
	\\

	\frac{1}{\rho^2} (
		\tilde\gamma \frac{1}{\rho} m^j m^2 
		- \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} m^j B^2
		+ \frac{1}{\mu_0} B^k m_k B^j
		- \gamma m^j E_{total} 
	) &

	\frac{1}{\rho} (
		- \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^2 \delta^j_k
		- \tilde\gamma \frac{1}{\rho} m^j m_k
		+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 \delta^j_k
		- \frac{1}{\mu_0} B_k B^j
		+ \gamma E_{total} \delta^j_k
	) &

	\frac{1}{\mu_0} \frac{1}{\rho} (
		(2 - \gamma) m^j B_k
		- m_k B^j
		- B^l m_l \delta^j_k
	) &

	\gamma \frac{1}{\rho} m^j
\end{matrix}\right] \left[\begin{matrix}
	\rho \\
	m^k \\
	B^k \\
	E_{total}
\end{matrix}\right]_{,j} + g_{kl,j}\left[\begin{matrix}
	0 \\
	
	- \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^k m^l g^{ij}
	+ \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^2 g^{ik} g^{lj}
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^k B^l g^{ij}
	- \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 g^{ik} g^{lj}
	- \tilde\gamma E_{total} g^{ik} g^{lj}
	\\

	0 \\

	- \frac{1}{2} \tilde\gamma \frac{1}{\rho^2} m^j m^k m^l
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} \frac{1}{\rho} m^j B^k B^l
	- \frac{1}{\mu_0} \frac{1}{\rho} B^k m^l B^j
\end{matrix}\right]$<br>
<br>

Flux covariant derivative:<br>
<br>

${F^{Ij}}_{;j}$<br>
$= \left[\begin{matrix}
	0 &
	\delta^j_k &
	0 & 
	0 \\

	\frac{1}{\rho^2} (
		- m^i m^j 
		+ \frac{1}{2} \tilde\gamma m^2 g^{ij}
	) &

	\frac{1}{\rho} (
		m^j \delta^i_k
		+ m^i \delta^j_k
		- \tilde\gamma m_k g^{ij}
	) &

	\frac{1}{\mu_0} (
		(2 - \gamma) B_k g^{ij}
		- B^j \delta^i_k
		- B^i \delta^j_k
	) &

	\tilde\gamma g^{ij}
	\\

	\frac{1}{\rho^2} (
		- B^i m^j 
		+ B^j m^i
	) &

	\frac{1}{\rho} (
		B^i \delta^j_k
		- B^j \delta^i_k
	) &

	\frac{1}{\rho} (
		m^j \delta^i_k
		- m^i \delta^j_k
	) &

	0
	\\

	\frac{1}{\rho^2} (
		\tilde\gamma \frac{1}{\rho} m^j m^2 
		- \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} m^j B^2
		+ \frac{1}{\mu_0} B^k m_k B^j
		- \gamma m^j E_{total} 
	) &

	\frac{1}{\rho} (
		- \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^2 \delta^j_k
		- \tilde\gamma \frac{1}{\rho} m^j m_k
		+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 \delta^j_k
		- \frac{1}{\mu_0} B_k B^j
		+ \gamma E_{total} \delta^j_k
	) &

	\frac{1}{\mu_0} \frac{1}{\rho} (
		(2 - \gamma) m^j B_k
		- m_k B^j
		- B^m m_m \delta^j_k
	) &

	\gamma \frac{1}{\rho} m^j
\end{matrix}\right] \left[\begin{matrix}
	\rho_{,j} \\
	{m^k}_{,j} + {\Gamma^k}_{lj} m^l \\
	{B^k}_{,j} + {\Gamma^k}_{lj} B^l \\
	E_{total,j}
\end{matrix}\right]$<br>
<br>

difference:<br>
<br>

${F^{Ij}}_{;j}$<br>
$= {F^{Ij}}_{,j}
+ \left[\begin{matrix}
	0 &
	\delta^j_k &
	0 & 
	0 \\

	\frac{1}{\rho^2} (
		- m^i m^j 
		+ \frac{1}{2} \tilde\gamma m^2 g^{ij}
	) &

	\frac{1}{\rho} (
		m^j \delta^i_k
		+ m^i \delta^j_k
		- \tilde\gamma m_k g^{ij}
	) &

	\frac{1}{\mu_0} (
		(2 - \gamma) B_k g^{ij}
		- B^j \delta^i_k
		- B^i \delta^j_k
	) &

	\tilde\gamma g^{ij}
	\\

	\frac{1}{\rho^2} (
		- B^i m^j 
		+ B^j m^i
	) &

	\frac{1}{\rho} (
		B^i \delta^j_k
		- B^j \delta^i_k
	) &

	\frac{1}{\rho} (
		m^j \delta^i_k
		- m^i \delta^j_k
	) &

	0
	\\

	\frac{1}{\rho^2} (
		\tilde\gamma \frac{1}{\rho} m^j m^2 
		- \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} m^j B^2
		+ \frac{1}{\mu_0} B^k m_k B^j
		- \gamma m^j E_{total} 
	) &

	\frac{1}{\rho} (
		- \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^2 \delta^j_k
		- \tilde\gamma \frac{1}{\rho} m^j m_k
		+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 \delta^j_k
		- \frac{1}{\mu_0} B_k B^j
		+ \gamma E_{total} \delta^j_k
	) &

	\frac{1}{\mu_0} \frac{1}{\rho} (
		(2 - \gamma) m^j B_k
		- m_k B^j
		- B^m m_m \delta^j_k
	) &

	\gamma \frac{1}{\rho} m^j
\end{matrix}\right] \left[\begin{matrix}
	0 \\
	{\Gamma^k}_{lj} m^l \\
	{\Gamma^k}_{lj} B^l \\
	0
\end{matrix}\right]
- g_{kl,j}\left[\begin{matrix}
	0 \\
	
	- \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^k m^l g^{ij}
	+ \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^2 g^{ik} g^{lj}
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^k B^l g^{ij}
	- \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 g^{ik} g^{lj}
	- \tilde\gamma E_{total} g^{ik} g^{lj}
	\\

	0 \\

	- \frac{1}{2} \tilde\gamma \frac{1}{\rho^2} m^j m^k m^l
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} \frac{1}{\rho} m^j B^k B^l
	- \frac{1}{\mu_0} \frac{1}{\rho} B^k m^l B^j
\end{matrix}\right]
$<br>
$= {F^{Ij}}_{,j}
+ \left[\begin{matrix}
	\delta^j_k {\Gamma^k}_{lj} m^l \\

	\frac{1}{\rho} (
		m^j \delta^i_k
		+ m^i \delta^j_k
		- \tilde\gamma m_k g^{ij}
	) {\Gamma^k}_{lj} m^l
	+ \frac{1}{\mu_0} (
		(2 - \gamma) B_k g^{ij}
		- B^j \delta^i_k
		- B^i \delta^j_k
	) {\Gamma^k}_{lj} B^l
	
	+ \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^k m^l g^{ij} (\Gamma_{klj} + \Gamma_{lkj})
	- \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^2 g^{ik} g^{lj} (\Gamma_{klj} + \Gamma_{lkj})
	- \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^k B^l g^{ij} (\Gamma_{klj} + \Gamma_{lkj})
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 g^{ik} g^{lj} (\Gamma_{klj} + \Gamma_{lkj})
	+ \tilde\gamma E_{total} g^{ik} g^{lj} (\Gamma_{klj} + \Gamma_{lkj})
	\\

	\frac{1}{\rho} (
		B^i \delta^j_k
		- B^j \delta^i_k
	) {\Gamma^k}_{lj} m^l
	+ \frac{1}{\rho} (
		m^j \delta^i_k
		- m^i \delta^j_k
	) {\Gamma^k}_{lj} B^l
	\\

	\frac{1}{\rho} (
		- \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^2 \delta^j_k
		- \tilde\gamma \frac{1}{\rho} m^j m_k
		+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 \delta^j_k
		- \frac{1}{\mu_0} B_k B^j
		+ \gamma E_{total} \delta^j_k
	) {\Gamma^k}_{lj} m^l
	+ \frac{1}{\mu_0} \frac{1}{\rho} (
		(2 - \gamma) m^j B_k
		- m_k B^j
		- B^m m_m \delta^j_k
	) {\Gamma^k}_{lj} B^l

	+ \frac{1}{2} \tilde\gamma \frac{1}{\rho^2} m^j m^k m^l (\Gamma_{klj} + \Gamma_{lkj})
	- \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} \frac{1}{\rho} m^j B^k B^l (\Gamma_{klj} + \Gamma_{lkj})
	+ \frac{1}{\mu_0} \frac{1}{\rho} B^k m^l B^j (\Gamma_{klj} + \Gamma_{lkj})
\end{matrix}\right]
$<br>

$= {F^{Ij}}_{,j}
+ {\Gamma^k}_{jk} F^{Ij}
+ \left[\begin{matrix}
	0 \\

	\frac{1}{\rho} (
		{\Gamma^i}_{jk} m^j m^k
		- \tilde\gamma {\Gamma_{jk}}^i m^j m^k
	)
	+ \frac{1}{\mu_0} (
		(2 - \gamma) {\Gamma_{jk}}^i B^j B^k
		- {\Gamma^i}_{jk} B^j B^k
	)
	
	+ \frac{1}{2} \tilde\gamma \frac{1}{\rho} {\Gamma_{jk}}^i m^j m^k
	- \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^2 g^{jk} {\Gamma^i}_{jk}
	- \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} {\Gamma_{jk}}^i B^j B^k
	+ \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^2 g^{jk} {\Gamma^i}_{jk}
	+ \tilde\gamma E_{total} {\Gamma^i}_{jk} g^{jk}
	
	+ \frac{1}{2} \tilde\gamma \frac{1}{\rho} m^j m^k {\Gamma_{jk}}^i
	- \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} B^j B^k {\Gamma_{jk}}^i
	\\

	0 \\
	
	\frac{1}{\rho} (
		- \tilde\gamma \frac{1}{\rho} m^j m_k {\Gamma^k}_{lj} m^l
		- \frac{1}{\mu_0} B_k B^j {\Gamma^k}_{lj} m^l
	)
	+ \frac{1}{\mu_0} \frac{1}{\rho} (
		(2 - \gamma) m^j B_k {\Gamma^k}_{lj} B^l
		- m_k B^j {\Gamma^k}_{lj} B^l
	)

	+ \frac{1}{2} \tilde\gamma \frac{1}{\rho^2} m^j m^k m^l \Gamma_{klj}
	- \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} \frac{1}{\rho} m^j B^k B^l \Gamma_{klj}
	+ \frac{1}{\mu_0} \frac{1}{\rho} B^k m^l B^j \Gamma_{klj}
	
	+ \frac{1}{2} \tilde\gamma \frac{1}{\rho^2} m^j m^k m^l \Gamma_{lkj}
	- \frac{1}{2} (2 - \gamma) \frac{1}{\mu_0} \frac{1}{\rho} m^j B^k B^l \Gamma_{lkj}
	+ \frac{1}{\mu_0} \frac{1}{\rho} B^k m^l B^j \Gamma_{lkj}
\end{matrix}\right]$<br>

$= \frac{1}{\sqrt{g}} ( \sqrt{g} F^{Ij} )_{,j}

+ \left[\begin{matrix}
	0 \\

	{\Gamma^i}_{jk} (
		\frac{1}{\rho} m^j m^k
		+ P_{total} g^{jk}
		- \frac{1}{\mu_0} B^j B^k
	)	
	\\

	0 \\
	
	0	
\end{matrix}\right]$<br>
<br>

[1]: <a href='http://www.av8n.com/physics/euler-flow.htm'>http://www.av8n.com/physics/euler-flow.htm</a>:<br>
[2]: <a href='https://en.wikipedia.org/wiki/Maxwell%27s_equations'>https://en.wikipedia.org/wiki/Maxwell%27s_equations</a><br>
[3]: <a href='https://en.wikipedia.org/wiki/Lorentz_force'>https://en.wikipedia.org/wiki/Lorentz_force</a><br>
[4]: <a href='https://en.wikipedia.org/wiki/Magnetic_pressure'>https://en.wikipedia.org/wiki/Magnetic_pressure</a><br>
[5]: <a href='http://www.mpia.de/homes/dullemon/lectures/fluiddynamics/'>http://www.mpia.de/homes/dullemon/lectures/fluiddynamics/</a><br>
[6]: Samtaney (1997). Computational Methods for Self-similar Solutions of the Compressible Euler Equations. Journal of Computational Physics, 132, 327-345<br>
[7]: Toro (1999), Riemann Solvers and Numerical Methods for Fluid Dynamics, 2nd Ed. 115-<br>
[8]: Keyes, JFNK<br>
	</body>
</html>
