<!doctype html>
<html>
	<head>
        <meta charset="UTF-8">
		<title>Euler Fluid Equation - Curved Geometry</title>
		<!-- script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script -->
		<script type="text/javascript" async src="file:///home/chris/Projects/christopheremoore.net/MathJax/MathJax.js?config=TeX-MML-AM_CHTML"></script>
		<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script>
	</head>
	<body>

<h3>Euler Fluid Equations</h3>

variables:<br>

variables:<br>
$\rho =$ density<br>
$v_i =$ velocity<br>
$m_i = \rho v_i = $ momentum<br>
$P =$ pressure<br>
$\gamma =$ heat capacity ratio<br>
$\tilde\gamma = \gamma - 1$<br>

$E_{kin} = \frac{1}{2} \rho v^k v_k$<br>
$E_{int} = \frac{P}{\tilde\gamma}$<br>
$E_{total} = E_{kin} + E_{int}$<br>
$H_{total} = E_{total} + P = \frac{1}{2} \rho v^2 + \frac{\gamma}{\tilde\gamma} P$<br>
<br>

Let $IJK...$ spanning $\{ \rho, v^i, E_{total} \}$<br>
<br>

Conservative and primitive variables:<br>
<br>

$W^I = \left[\matrix{ \rho \\ v^i \\ P }\right]$<br>
$U^I = \left[\matrix{ \rho \\ \rho v^i \\ E_{total} }\right]$<br>
<br>

$\frac{\partial U^I}{\partial W^J} = \left[\matrix{
	1 & 0 & 0 \\
	v^i & \rho \delta^i_j & 0 \\
	\frac{1}{2} v^2 & \rho v_j & 1/\tilde\gamma
}\right]$<br>
$\frac{\partial W^I}{\partial U^J} = \left[\matrix{
	1 & 0 & 0 \\
	-v^i / \rho & \delta^i_j / \rho & 0 \\
	\frac{1}{2} \tilde\gamma v^2 & -\tilde\gamma v_j & \tilde\gamma
}\right]$<br>
<br>

Flux term:<br>
$F^{Ij} = \left[\matrix{ \rho v^j \\ \rho v^i v^j + g^{ij} P \\ v^j H_{total} }\right]$<br>
<br>

Flux derivative wrt primitives:<br>

$\frac{\partial F^{Ij}}{\partial W^M} = \downarrow I \overset{\rightarrow M}{ \left[\matrix{
	v^j & \rho \delta^j_m & 0 \\
	v^i v^j & \rho (v^j \delta^i_m + v^i \delta^j_m) & g^{ij} \\
	\frac{1}{2} v^j v^2 & \delta^j_m H_{total} + \rho v^j v_m & \frac{\gamma}{\tilde{\gamma}} v^j
}\right] }$<br>
<br>

Euler fluid equations, curved geometry:<br>
<br>

$U^I + {F^{Ij}}_{;j} = 0$<br>
<br>

$\rho_{,t} + (\rho v^j)_{;j} = 0$<br>
$(\rho v^i)_{,t} + (\rho v^i v^j + g^{ij} P)_{;j} = 0$<br>
$E_{total,t} + (v^j H_{total})_{;j} = 0$<br>
<br>

$\rho_{,t} + (\rho v^j)_{;j} = 0$<br>
$(\rho v^i)_{,t} + (\rho v^i v^j)_{;j} + g^{ij} P_{,j} = 0$<br>
$E_{total,t} + (v^j H_{total})_{;j} = 0$<br>
<br>

$\rho_{,t} + (\rho v^j)_{,j} + {\Gamma^j}_{kj} \rho v^k = 0$<br>
$(\rho v^i)_{,t} + (\rho v^i v^j)_{,j} + g^{ij} P_{,j} + {\Gamma^i}_{kj} \rho v^k v^j + {\Gamma^j}_{kj} \rho v^i v^k = 0$<br>
$E_{total,t} + (v^j H_{total})_{,j} + {\Gamma^j}_{kj} v^k H_{total} = 0$<br>
<br>

$\rho_{,t} + \rho_{,j} v^j + \rho {v^j}_{,j} = -{\Gamma^j}_{kj} \rho v^k$<br>
$(\rho v^i)_{,t} + \rho_{,j} v^i v^j + \rho {v^i}_{,j} v^j + \rho v^i {v^j}_{,j} + g^{ij} P_{,j} = -{\Gamma^i}_{kj} \rho v^k v^j - {\Gamma^j}_{kj} \rho v^i v^k$<br>
$E_{total,t} + {v^j}_{,j} H_{total} + v^j (\frac{1}{2} \rho_{,j} v^2 + \rho v_k {v^k}_{,j} + \frac{\gamma}{\tilde\gamma} P_{,j}) = -{\Gamma^j}_{kj} v^k H_{total}$<br>
<br>

$\left[\matrix{
	\rho \\ \rho v^i \\ E_{total} 
}\right]_{,t}
+ \left[\matrix{
	v^j &
		\rho \delta^j_m &
		0 \\
	v^i v^j &
		\rho ( v^j \delta^i_m + v^i \delta^j_m ) &
		g^{ij} \\
	\frac{1}{2} v^j v^2 &
		\delta^j_m H_{total} + \rho v^j v_m &
		\frac{\gamma}{\tilde\gamma} v^j
}\right]
\left[\matrix{
	\rho \\ v^m \\ P
}\right]_{,j} = \left[\matrix{
	-{\Gamma^j}_{kj} \rho v^k \\
	-{\Gamma^i}_{kj} \rho v^k v^j - {\Gamma^j}_{kj} \rho v^i v^k \\
	-{\Gamma^j}_{kj} v^k H_{total}
}\right]$<br>
<br>

$\left[\matrix{
	\rho \\ \rho v^i \\ E_{total} 
}\right]_{,t}
+ \left[\matrix{
	v^j &
		\rho \delta^j_m &
		0 \\
	v^i v^j &
		\rho ( v^j \delta^i_m + v^i \delta^j_m ) &
		g^{ij} \\
	\frac{1}{2} v^j v^2 &
		\delta^j_m H_{total} + \rho v^j v_m &
		\frac{\gamma}{\tilde\gamma} v^j
}\right]
\left[\matrix{
	1 & 0 & 0 \\
	-v^m / \rho & \delta^m_k / \rho & 0 \\
	\frac{1}{2} \tilde\gamma v^2 & -\tilde\gamma v_k & \tilde\gamma
}\right]
\left[\matrix{
	\rho \\ \rho v_k \\ E_{total}
}\right]_{,j} = \left[\matrix{
	-{\Gamma^j}_{kj} \rho v^k \\
	-{\Gamma^i}_{kj} \rho v^k v^j - {\Gamma^j}_{kj} \rho v^i v^k \\
	-{\Gamma^j}_{kj} v^k H_{total}
}\right]$<br>
<br>


$\left[\matrix{
	\rho \\ \rho v^i \\ E_{total} 
}\right]_{,t}
+ \left[\matrix{
	0 &
		\delta^j_k &
		0 \\
	-v^i v^j + \frac{1}{2} g^{ij} \tilde\gamma v^2 &
		\delta^i_k v^j + \delta^j_k v^i - g^{ij} \tilde\gamma v_k &
		g^{ij} \tilde\gamma \\
	v^j (\frac{1}{2} \tilde\gamma v^2 - h_{total}) &
		-\tilde\gamma v^j v_k + \delta^j_k h_{total} &
		\gamma v^j
}\right]
\left[\matrix{
	\rho \\ \rho v^k \\ E_{total} 
}\right]_{,j} = \left[\matrix{
	-{\Gamma^j}_{kj} \rho v^k \\
	-{\Gamma^i}_{kj} \rho v^k v^j - {\Gamma^j}_{kj} \rho v^i v^k \\
	-{\Gamma^j}_{kj} v^k H_{total}
}\right]$<br>
<br>

...and Maxima has so much harder time calculating the eigenvalues/vectors even for a diagonal-only metric that I'm giving up and just representing my vectors/fluxes in cartesian coordinates<br>
<br>

So let's try using acoustic tensor to find the eigen-decomposition of the flux in curved coordinates:<br>
<br>

$\frac{\partial W^N}{\partial U^I} \cdot \frac{\partial F^{Ij}}{\partial W^M}$
$= \downarrow N \overset{\rightarrow I}{\left[\matrix{
	1 & 0 & 0 \\
	-v^n / \rho & \delta^n_i / \rho & 0 \\
	\frac{1}{2} \tilde\gamma v^2 & -\tilde\gamma v_i & \tilde\gamma
}\right]} \cdot \downarrow I \overset{\rightarrow M}{\left[\matrix{
	v^j & \rho \delta^j_m & 0 \\
	v^i v^j & \rho (v^j \delta^i_m + v^i \delta^j_m) & g^{ij} \\
	\frac{1}{2} v^j v^2 & \delta^j_m H_{total} + \rho v^j v_m & \frac{\gamma}{\tilde{\gamma}} v^j
}\right]}$
$= \downarrow N \overset{\rightarrow M}{\left[\matrix{
	v^j & \rho \delta^j_m & 0 \\
	0 & v^j \delta^n_m & g^{jn} / \rho \\
	0 & \delta^j_m \gamma P & v^j
}\right]}$
$= {A^{jN}}_M + v^j \delta^N_M$<br>
<br>
...for acoustic tensor:<br>
${A^{jN}}_M = \downarrow N \overset{\rightarrow M}{\left[\matrix{
	0 & \rho \delta^j_m & 0 \\
	0 & 0 & g^{jn} / \rho \\
	0 & \delta^j_m \gamma P & 0
}\right]}$<br>
<br>

Acoustic tensor eigen-decomposition:<br> 

$\Lambda_{A^j} = \left[\matrix{
	c_s \sqrt{g^{jj}} & 0 & 0 \\
	0 & 0 & 0 \\
	0 & 0 & -c_s \sqrt{g^{jj}}
}\right]$<br>
<br>

${(Q_{A^j})^I}_K = \downarrow I \overset{\rightarrow K}{ \left[\matrix{
	\rho \sqrt{g^{jj}} & \delta^j_k & \rho \sqrt{g^{jj}} \\
	c_s g^{ij} & \delta^i_k - \delta^{ij} \delta_{jk} & -c_s g^{ij} \\
	\gamma P \sqrt{g^{jj}} & 0 & \gamma P \sqrt{g^{jj}}
}\right]}$<br>

${(Q^{-1}_{A^j} )^I}_K = \downarrow I \overset{\rightarrow K}{ \left[\matrix{
	0 & \delta_{jk} \frac{1}{2 c_s g^{jj}} & \frac{1}{2 \gamma P \sqrt{g^{jj}}} \\
	\delta^{ij} & \delta^i_k - \frac{g^{ij}}{g^{jj}} & -\delta^{ij} \frac{1}{(c_s)^2} \\
	0 & -\delta_{jk} \frac{1}{2 c_s g^{jj}} & \frac{1}{2 \gamma P \sqrt{g^{jj}}}
}\right]}$<br>
<br>

...with some index notation summation abuse present.  I'll just write them out completely:<br>
<br>
eigenvalues, right eigenvectors, left eigenvectors:<br>

$\Lambda_{A^x} = \left[\matrix{
	c_s \sqrt{g^{xx}} & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & -c_s \sqrt{g^{xx}} 
}\right]$, 
$V^R_{A^x} = \left[\matrix{
	\rho \sqrt{g^{xx}} & 1 & 0 & 0 & \rho \sqrt{g^{xx}} \\
	c_s g^{xx} & 0 & 0 & 0 & -c_s g^{xx} \\
	c_s g^{xy} & 0 & 1 & 0 & -c_s g^{xy} \\
	c_s g^{xz} & 0 & 0 & 1 & -c_s g^{xz} \\
	\gamma P \sqrt{g^{xx}} & 0 & 0 & 0 & \gamma P \sqrt{g^{xx}}
}\right]$
$V^L_{A^x} = \left[\matrix{
	0 & \frac{1}{2 c_s g^{xx}} & 0 & 0 & \frac{1}{2 \gamma P \sqrt{g^{xx}}} \\
	1 & 0 & 0 & 0 & -\frac{1}{(c_s)^2} \\
	0 & -\frac{g^{xy}}{g^{xx}} & 1 & 0 & 0 \\
	0 & -\frac{g^{xz}}{g^{xx}} & 0 & 1 & 0 \\
	0 & -\frac{1}{2 c_s g^{xx}} & 0 & 0 & \frac{1}{2 \gamma P \sqrt{g^{xx}}}
}\right]$
<br>

$\Lambda_{A^y} = \left[\matrix{
	c_s \sqrt{g^{yy}} & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & -c_s \sqrt{g^{yy}} 
}\right]$
$V^R_{A^y} = \left[\matrix{
	\rho \sqrt{g^{yy}} & 0 & 1 & 0 & \rho \sqrt{g^{yy}} \\
	c_s g^{yx} & 1 & 0 & 0 & -c_s g^{yx} \\
	c_s g^{yy} & 0 & 0 & 0 & -c_s g^{yy} \\
	c_s g^{yz} & 0 & 0 & 1 & -c_s g^{yz} \\
	\gamma P \sqrt{g^{yy}} & 0 & 0 & 0 & \gamma P \sqrt{g^{yy}}
}\right]$
$V^L_{A^y} = \left[\matrix{
	0 & 0 & \frac{1}{2 c_s g^{yy}} & 0 & \frac{1}{2 \gamma P \sqrt{g^{yy}}} \\
	0 & 1 & -\frac{g^{yx}}{g^{yy}}  & 0 & 0 \\ 
	1 & 0 & 0 & 0 & -\frac{1}{(c_s)^2} \\
	0 & 0 & -\frac{g^{yz}}{g^{yy}} & 1 & 0 \\
	0 & 0 & -\frac{1}{2 c_s g^{yy}} & 0 & \frac{1}{2 \gamma P \sqrt{g^{yy}}}
}\right]$
<br>

$\Lambda_{A^z} = \left[\matrix{
	c_s \sqrt{g^{zz}} & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & -c_s \sqrt{g^{zz}} 
}\right]$
$V^R_{A^z} = \left[\matrix{
	\rho \sqrt{g^{zz}} & 0 & 0 & 1 & \rho \sqrt{g^{zz}} \\
	c_s g^{xz} & 1 & 0 & 0 & -c_s g^{xz} \\
	c_s g^{yz} & 0 & 1 & 0 & -c_s g^{yz} \\
	c_s g^{zz} & 0 & 0 & 0 & -c_s g^{zz} \\
	\gamma P \sqrt{g^{zz}} & 0 & 0 & 0 & \gamma P \sqrt{g^{zz}}
}\right]$
$V^L_{A^z} = \left[\matrix{
	0 & 0 & 0 & \frac{1}{2 c_s g^{zz}} & \frac{1}{2 \gamma P \sqrt{g^{zz}}} \\
	0 & 1 & 0 & -\frac{g^{zx}}{g^{zz}} & 0 \\ 
	0 & 0 & 1 & -\frac{g^{zy}}{g^{zz}} & 0 \\
	1 & 0 & 0 & 0 & -\frac{1}{(c_s)^2} \\
	0 & 0 & -\frac{1}{2 c_s g^{zz}} & 0 & \frac{1}{2 \gamma P \sqrt{g^{zz}}}
}\right]$
<br>

Now $\frac{\partial F^{jI}}{\partial U^J}$
$ = \frac{\partial F^{jI}}{\partial W^K} \cdot \frac{\partial W^K}{\partial U^J}$
$ = \frac{\partial U}{\partial W} \frac{\partial W}{\partial U} \frac{\partial F}{\partial W} \frac{\partial W}{\partial U}$
$ = \frac{\partial U}{\partial W} (A + v_j I) \frac{\partial W}{\partial U}$<br>
<br>

The eigenvalues of $F$ are $A + v^j I = \left[\matrix{
	v^j + c_s \sqrt{g^{jj}} & 0 & 0 & 0 & 0 \\
	0 & v^j & 0 & 0 & 0 \\
	0 & 0 & v^j & 0 & 0 \\
	0 & 0 & 0 & v^j & 0 \\
	0 & 0 & 0 & 0 & v^j - c_s \sqrt{g^{jj}}
}\right]$<br>
<br>

The right eigenvectors of $F$ are $V^R_{F^j} = \frac{\partial U}{\partial W} \cdot V^R_{A^j}$<br>
<br>

<hr>


This source: <a href='https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19870019781.pdf'>https://ntrs.nasa.gov/archive/nasa/casi.ntrs.nasa.gov/19870019781.pdf</a>
gets around that by using the covariant form of the momentum in the state vector:<br>
What's the advantage of this?  By putting $v_i$ on the same variance as $P_{,i}$, we remove the extra $g^{ij}$ from the flux matrix.<br> 
However we replace it with a $g_{ij,k}$ source term (which the paper calls a "coriolis force").<br> 
<br>

$\rho_{,t} + (\rho v^j)_{;j} = 0$<br>
$(\rho v_i)_{,t} + (\rho v_i v^j + \delta_i^j P)_{;j} = 0$<br>
$E_{total,t} + (v^j H_{total})_{;j} = 0$<br>
<br>

$\rho_{,t} + (\rho v^j)_{;j} = 0$<br>
$(\rho v_i)_{,t} + (\rho v_i v^j)_{;j} + \delta_i^j P_{,j} = 0$<br>
$E_{total,t} + (v^j H_{total})_{;j} = 0$<br>
<br>

$\rho_{,t} + (\rho v^j)_{,j} + {\Gamma^j}_{kj} \rho v^k = 0$<br>
$(\rho v_i)_{,t} + (\rho v_i v^j)_{,j} + \delta_i^j P_{,j} - {\Gamma^k}_{ij} \rho v_k v^j + {\Gamma^j}_{kj} \rho v_i v^k = 0$<br>
$E_{total,t} + (v^j H_{total})_{,j} + {\Gamma^j}_{kj} v^k H_{total} = 0$<br>
<br>

$\rho_{,t} + \frac{\sqrt{g}}{\sqrt{g}} (\rho v^j)_{,j} + \frac{1}{\sqrt{g}} (\sqrt{g})_{,k} \rho v^k = 0$<br>
$(\rho v_i)_{,t} 
	+ \frac{\sqrt{g}}{\sqrt{g}} (\rho v_i v^j)_{,j} 
	+ \frac{\sqrt{g}}{\sqrt{g}} \delta_i^j P_{,j} 
	- {\Gamma^k}_{ij} \rho v_k v^j 
	+ \frac{1}{\sqrt{g}} (\sqrt{g})_{,k} \rho v_i v^k 
	= 0$<br>
$E_{total,t} + \frac{\sqrt{g}}{\sqrt{g}} (v^j H_{total})_{,j} + \frac{1}{\sqrt{g}} (\sqrt{g})_{,k} v^k H_{total} = 0$<br>
<br>

$\rho_{,t} + \frac{1}{\sqrt{g}} (\sqrt{g} \rho v^j)_{,j} = 0$<br>
$(\rho v_i)_{,t} 
	+ \frac{1}{\sqrt{g}} (\sqrt{g} \rho v_i v^j)_{,j} 
	+ \frac{1}{\sqrt{g}} (\sqrt{g} \delta_i^j P)_{,j}
	- \frac{1}{\sqrt{g}} (\sqrt{g})_{,j} \delta^j_i P
	- {\Gamma^k}_{ij} \rho v_k v^j 
	= 0$<br>
$E_{total,t} + \frac{1}{\sqrt{g}} (\sqrt{g} v^j H_{total})_{,j} = 0$<br>
<br>

$\rho_{,t} + \frac{1}{\sqrt{g}} (\sqrt{g} \rho v^j)_{,j} = 0$<br>
$(\rho v_i)_{,t} 
	+ \frac{1}{\sqrt{g}} (\sqrt{g} (\rho v_i v^j + \delta_i^j P))_{,j} 
	= \Gamma_{kji} \rho v^j v^k
	+ \frac{1}{\sqrt{g}} (\sqrt{g})_{,j} \delta^j_i P
	$<br>
$E_{total,t} + \frac{1}{\sqrt{g}} (\sqrt{g} v^j H_{total})_{,j} = 0$<br>
<br>

$\rho v^j v^k \Gamma_{kj,i} = \frac{1}{2} \rho v^j v^k (g_{kj,i} + g_{ki,j} - g_{ji,k}) = \frac{1}{2} \rho v^j v^k g_{jk,i}$<br>
and $(\sqrt{g})_{,j} = \frac{1}{2 \sqrt{g}} g_{,j} = \frac{1}{2\sqrt{g}} g g^{jk} g_{jk,i} = \frac{1}{2} \sqrt{g} g^{jk} g_{jk,i}$ using the Jacobi's formula.<br>
so $\frac{1}{\sqrt{g}} (\sqrt{g})_{,j} P = \frac{1}{2} g^{jk} g_{jk,i} P$<br>
<br>

$\rho_{,t} + \frac{1}{\sqrt{g}} (\sqrt{g} \rho v^j)_{,j} = 0$<br>
$(\rho v_i)_{,t} 
	+ \frac{1}{\sqrt{g}} (\sqrt{g} (\rho v_i v^j + \delta_i^j P))_{,j} 
	= \frac{1}{2} g_{jk,i} (\rho v^j v^k + g^{jk} P)$<br>
$E_{total,t} + \frac{1}{\sqrt{g}} (\sqrt{g} v^j H_{total})_{,j} = 0$<br>
<br>

So now that there is a $\sqrt{g}$ inside the flux term, where does it go in the eigen decomposition?<br>
I'm also tempted to not use this because Font' descriptions of relativistic Euler equations keeps the velocity in contravariant form.<br>
And to boot, it doesn't provide eigen-decomposition...<br>

	</body>
</html>
