<!doctype html>
<html>
	<head>
        <meta charset='utf-8'>
		<script type='text/javascript' src='tryToFindMathJax.js'></script>
		<title>Maxwell Equations as Hyperbolic Conservation Laws</title>
	</head>
	<body onload='tryToFindMathJax();'>

<h3>Maxwell Equations of charge in vacuum</h3>
$B_{x,x} + B_{y,y} + B_{z,z} = 0$<br>
$\epsilon_0 (E_{x,x} + E_{y,y} + E_{z,z}) = \rho_{charge}$<br>
$\epsilon_0 E_{x,t} - \frac{1}{\mu_0} B_{z,y} + \frac{1}{\mu_0} B_{y,z} = -j_x$<br>
$\epsilon_0 E_{y,t} - \frac{1}{\mu_0} B_{x,z} + \frac{1}{\mu_0} B_{z,x} = -j_y$<br>
$\epsilon_0 E_{z,t} - \frac{1}{\mu_0} B_{y,x} + \frac{1}{\mu_0} B_{x,y} = -j_z$<br>
$B_{x,t} + E_{z,y} - E_{y,z} = 0$<br>
$B_{y,t} + E_{x,z} - E_{z,x} = 0$<br>
$B_{z,t} + E_{y,x} - E_{x,y} = 0$<br>
<br>

<h3>in vector notation:</h3>
$\partial_t \left[ \begin{matrix}
	\epsilon_0 E_x \\
	\epsilon_0 E_y \\
	\epsilon_0 E_z \\
	B_x \\
	B_y \\
	B_z
\end{matrix} \right] + \nabla \cdot \left[\begin{matrix}
	0 & -\frac{1}{\mu_0} B_z & \frac{1}{\mu_0} B_y \\
	\frac{1}{\mu_0} B_z & 0 & -\frac{1}{\mu_0} B_x \\
	-\frac{1}{\mu_0} B_y & \frac{1}{\mu_0} B_x & 0 \\
	0 & E_z & -E_y \\
	-E_z & 0 & E_x \\
	E_y & -E_x & 0
\end{matrix}\right] = \left[\begin{matrix}
-j_x \\
-j_y \\
-j_z \\
0 \\
0 \\
0
\end{matrix}\right]$<br>

<h3>in index notation:</h3>
$B_{i,i} = 0$<br>
$B_{i,t} + {\epsilon_i}^{jk} E_{k,j} = 0$<br>
<br>
$E_{i,i} = \frac{1}{\epsilon_0} \rho_{charge}$<br>
$(\epsilon_0 E)_{i,t} - {\epsilon_i}^{jk} (\frac{1}{\mu_0} B)_{k,j} = -j_i$<br>
<br>
$j_i = \sigma E_i = $ current density<br>
$\sigma = $ electric conductivity<br>
<br>

conservative variables:<br>
$U_i = \left[\matrix{
	\epsilon_0 E_i \\
	B_i
}\right]$<br>
<br>

conservative form:<br>
$U_i + A_{ijk} U_{k,j} = S_i$<br>
<br>

index/matrix form:<br>
$\left[\matrix{
	\epsilon_0 E_i \\
	B_i
}\right] + \left[\matrix{
	0 & - \frac{1}{\mu_0} {\epsilon_i}^{jk} \\
	\frac{1}{\epsilon_0} {\epsilon_i}^{jk} & 0
}\right] 
\left[\matrix{
	\epsilon_0 E_k \\
	B_k
}\right]_{,j}
= \left[\matrix{
	-j_i \\
	0
}\right]$<br>
<br>

$A_x = \left[\matrix{
	0 & 0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 & \frac{1}{\mu_0} \\
	0 & 0 & 0 & 0 & -\frac{1}{\mu_0} & 0 \\
	0 & 0 & 0 & 0 & 0 & 0 \\
	0 & 0 & -\frac{1}{\epsilon_0} & 0 & 0 & 0 \\
	0 & \frac{1}{\epsilon_0} & 0 & 0 & 0 & 0
}\right]$<br>
<br>

$A_y = \left[\matrix{
	0 & 0 & 0 & 0 & 0 & -\frac{1}{\mu_0} \\
	0 & 0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & \frac{1}{\mu_0} & 0 & 0 \\
	0 & 0 & \frac{1}{\epsilon_0} & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 & 0 \\
	-\frac{1}{\epsilon_0} & 0 & 0 & 0 & 0 & 0
}\right]$<br>
<br>

$A_z = \left[\matrix{
	0 & 0 & 0 & 0 & \frac{1}{\mu_0} & 0 \\
	0 & 0 & 0 & -\frac{1}{\mu_0} & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 & 0 \\
	0 & -\frac{1}{\epsilon_0} & 0 & 0 & 0 & 0 \\
	\frac{1}{\epsilon_0} & 0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 & 0
}\right]$<br>
<br>

eigen decomposition:<br>
$A_j = Q \Lambda Q^{-1}$<br>
<br>
for the $\hat{x}$-direction, with $\hat{x}, \hat{y}, \hat{z}$ forming a basis:<br>
$Q = \left[\matrix{
	\sqrt{\epsilon_0} \hat{y} & 
		\sqrt{\epsilon_0} \hat{z} & 
		\sqrt{\epsilon_0} \hat{x} & 
		0 & 
		\sqrt{\epsilon_0} \hat{y} & 
		-\sqrt{\epsilon_0} \hat{z} \\
	-\sqrt{\mu_0} \hat{z} & 
		\sqrt{\mu_0} \hat{y} & 
		0 & 
		\sqrt{\mu_0} \hat{x} & 
		\sqrt{\mu_0} \hat{z} & 
		-\sqrt{\mu_0} \hat{y}
}\right]$<br>
<br>

$Q^-1 = \left[\matrix{
	\hat{z} & \hat{x} & \hat{y} & 0 & \hat{y} & -\hat{x} \\
	0 & \hat{y} & \hat[z] & \hat{x} & -\hat{z} & \hat{y}
}\right]$<br>
<br>

$\Lambda = \left[\matrix{
	-\frac{1}{\sqrt{\epsilon_0 \mu_0}} & 0 & 0 & 0 & 0 & 0 \\
	0 & -\frac{1}{\sqrt{\epsilon_0 \mu_0}} & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & 0 & 0 \\
	0 & 0 & 0 & 0 & \frac{1}{\sqrt{\epsilon_0 \mu_0}} & 0 \\
	0 & 0 & 0 & 0 & 0 & \frac{1}{\sqrt{\epsilon_0 \mu_0}}
}\right]$<br>
<br>

<h3>curvilinear coordinates</h3>
conserved quantities:<br>
$U^I = \left[\matrix{ 
	\epsilon_0 E^i \\ B^i 
}\right]$<br>
<br>

Flux:<br>
$F^{Ij} = \left[\matrix{ 
	-\frac{1}{\mu_0} {\epsilon^{ij}}_k B^k \\
	{\epsilon^{ij}}_k E^k
}\right]$<br>
$= \left[\matrix{ 
	-\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} B^l \\
	\frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} E^l
}\right]$<br>
<br>

flux partial derivative:<br>
${F^{Ij}}_{,j} = \left[\matrix{ 
	-\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} B^l \\
	\frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} E^l
}\right]_{,j}$<br>
$= \left[\matrix{ 
	-\frac{1}{\mu_0} \bar\epsilon^{ijk} ((\frac{1}{\sqrt{g}})_{,j} g_{kl} B^l + \frac{1}{\sqrt{g}} g_{kl,j} B^l + \frac{1}{\sqrt{g}} g_{kl} {B^l}_{,j}) \\
	\bar\epsilon^{ijk} ((\frac{1}{\sqrt{g}})_{,j} g_{kl} E^l + \frac{1}{\sqrt{g}} g_{kl,j} E^l + \frac{1}{\sqrt{g}} g_{kl} {E^l}_{,j})
}\right]$<br>
$= \left[\matrix{ 
	-\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} ( -\frac{1}{\sqrt{g}} (\sqrt{g})_{,j} B_k + g_{kl,j} B^l + g_{kl} {B^l}_{,j}) \\
	\frac{1}{\sqrt{g}} \bar\epsilon^{ijk} ( -\frac{1}{\sqrt{g}} (\sqrt{g})_{,j} E_k + g_{kl,j} E^l + g_{kl} {E^l}_{,j})
}\right]$<br>
$= \left[\matrix{ 
	-\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} {B^l}_{,j} \\
	\frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} {E^l}_{,j}
}\right] + \left[\matrix{
	 -\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} (-\frac{1}{\sqrt{g}} (\sqrt{g})_{,j} B_k + g_{kl,j} B^l) \\
	 \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} (-\frac{1}{\sqrt{g}} (\sqrt{g})_{,j} E_k + g_{kl,j} E^l) 
}\right]$<br>
<br>
flux covariant derivative:<br>
${F^{Ij}}_{;j} = \left[\matrix{ 
	\frac{1}{\mu_0} \bar\epsilon^{ijk} \frac{1}{\sqrt{g}} g_{kl} {B^l}_{;j} \\
	-\bar\epsilon^{ijk} \frac{1}{\sqrt{g}} g_{kl} {E^l}_{;j}	
}\right]$<br>
$= \left[\matrix{ 
	\frac{1}{\mu_0} \bar\epsilon^{ijk} \frac{1}{\sqrt{g}} g_{kl} ({B^l}_{,j} + {\Gamma^l}_{mj} B^m) \\
	-\bar\epsilon^{ijk} \frac{1}{\sqrt{g}} g_{kl} ({E^l}_{,j}	+ {\Gamma^l}_{mj} E^m)
}\right]$<br>
$= \left[\matrix{ 
	\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} {B^l}_{,j} \\
	-\frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} {E^l}_{,j}
}\right] + \left[\matrix{
	-\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} \Gamma_{jkl} B^l \\
	\frac{1}{\sqrt{g}} \bar\epsilon^{ijk} \Gamma_{jkl} E^l
}\right]$<br>
<br>
Add and subtract the flux weighted by the volume gradient and the metric partial terms.<br>
This is what the code in my curvilinear solver does by default.  But maybe this should be enabled on a per-equation-system basis.  It seems to be unnecessary for the Maxwell equations.<br>
<br>
${F^{Ij}}_{;j} = \left[\matrix{ 
	\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} {B^l}_{,j} \\
	-\frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} {E^l}_{,j}
}\right]

 + \left[\matrix{
	 -\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} (-\frac{1}{\sqrt{g}} (\sqrt{g})_{,j} B_k + g_{kl,j} B^l) \\
	 \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} (-\frac{1}{\sqrt{g}} (\sqrt{g})_{,j} E_k + g_{kl,j} E^l) 
}\right]

- \left[\matrix{
	 -\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} (-\frac{1}{\sqrt{g}} (\sqrt{g})_{,j} B_k + g_{kl,j} B^l) \\
	 \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} (-\frac{1}{\sqrt{g}} (\sqrt{g})_{,j} E_k + g_{kl,j} E^l) 
}\right]
+ \frac{\sqrt{g}_{,j}}{\sqrt{g}} \left[\matrix{
	-\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} B^l \\
	\frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} E^l
}\right]

- \frac{\sqrt{g}_{,j}}{\sqrt{g}} \left[\matrix{
	-\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} B^l \\
	\frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} E^l
}\right]

+ \left[\matrix{
	-\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} \Gamma_{jkl} B^l \\
	\frac{1}{\sqrt{g}} \bar\epsilon^{ijk} \Gamma_{jkl} E^l
}\right]$<br>

$ = \frac{\sqrt{g}}{\sqrt{g}} {F^{Ij}}_{,j} 

+ \frac{\sqrt{g}_{,j}}{\sqrt{g}} F^{Ij}

+ \left[\matrix{
	-\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} \Gamma_{jkl} B^l \\
	\frac{1}{\sqrt{g}} \bar\epsilon^{ijk} \Gamma_{jkl} E^l
}\right]

- \left[\matrix{
	 -\frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} (-{\Gamma^m}_{jm} B_k + (\Gamma_{klj} + \Gamma_{lkj}) B^l) \\
	 \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} (-{\Gamma^m}_{jm} E_k + (\Gamma_{klj} + \Gamma_{lkj}) E^l) 
}\right]

- \left[\matrix{
	-{\Gamma^m}_{jm} \frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} B^l \\
	{\Gamma^m}_{jm} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} g_{kl} E^l
}\right]
$<br>

$ = \frac{1}{\sqrt{g}} \left( \sqrt{g} F^{Ij} \right)_{,j} 

+ \left[\matrix{
	-2 \frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} \Gamma_{jkl} B^l \\
	2 \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} \Gamma_{jkl} E^l
}\right]
$<br>
<br>

<h3>hyperbolic conservation law system:</h3>
${U^i}_{,t} + {F^{ij}}_{;j} = S^i$<br>
${U^i}_{,t} + \frac{1}{\sqrt{g}} \left( \sqrt{g} F^{ij} \right)_{,j} = S^i + \left[\matrix{
	2 \frac{1}{\mu_0} \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} \Gamma_{jkl} B^l \\
	-2 \frac{1}{\sqrt{g}} \bar\epsilon^{ijk} \Gamma_{jkl} E^l
}\right]$<br>
<br>


<br>

	</body>
</html>
